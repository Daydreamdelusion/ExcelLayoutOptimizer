# Excelè¡¨æ ¼å¿«é€Ÿç¾åŒ–ç³»ç»Ÿ v4.2 (æç®€éƒ¨ç½²ç‰ˆ)

> **âš ï¸ R1C1æ¶æ„è¯´æ˜**ï¼šæœ¬ç³»ç»Ÿç»Ÿä¸€é‡‡ç”¨R1C1å¼•ç”¨é£æ ¼è¿›è¡Œå†…éƒ¨è§£æå’Œæ‰§è¡Œï¼Œæ‰€æœ‰æ¡ä»¶æ ¼å¼å…¬å¼å‡ä¸ºR1C1æ ¼å¼ã€‚ç”¨æˆ·ç•Œé¢ä»æ˜¾ç¤ºA1é£æ ¼ï¼Œä½†ç³»ç»Ÿå†…éƒ¨ç»Ÿä¸€R1C1å¤„ç†ã€‚

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®èƒŒæ™¯
ä¸“ä¸ºå¿«é€Ÿéƒ¨ç½²è®¾è®¡çš„Excelè¡¨æ ¼ç¾åŒ–ç³»ç»Ÿï¼ŒçœŸæ­£çš„å•VBAæ¨¡å—å®ç°ï¼Œå¯¼å…¥å³ç”¨ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚

### 1.2 v4.2 æç®€å‡çº§
**ä¸‰å¤§æ ¸å¿ƒåŸåˆ™ï¼Œæè‡´ç®€åŒ–éƒ¨ç½²**ï¼š

#### 1.2.1 çœŸå•æ¨¡å—æ¶æ„ï¼šä¸€æ–‡ä»¶éƒ¨ç½² ğŸ“
- **çº¯VBAå®ç°**ï¼šä»…ä¸€ä¸ª.basæ–‡ä»¶ï¼Œæ— UserFormã€æ— é…ç½®æ–‡ä»¶
- **é›¶ä¾èµ–éƒ¨ç½²**ï¼šå¯¼å…¥æ¨¡å—å³å¯ä½¿ç”¨ï¼Œæ— éœ€é¢å¤–å®‰è£…
- **å³ç”¨è®¾è®¡**ï¼šè¿è¡Œä¸€ä¸ªå‡½æ•°å³å¯å®Œæˆç¾åŒ–

#### 1.2.2 æ ¸å¿ƒç¾åŒ–åŠŸèƒ½ï¼šä¸“æ³¨æœ¬è´¨ ğŸ¯
- **è¡¨å¤´ç¾åŒ–**ï¼šè‡ªåŠ¨è¯†åˆ«å¹¶ç¾åŒ–è¡¨å¤´åŒºåŸŸ
- **æ¡ä»¶æ ¼å¼**ï¼šè´Ÿæ•°æ ‡çº¢ã€é‡å¤æ ‡é»„ã€ç©ºå€¼æ ‡ç°
- **è¾¹æ¡†æ ·å¼**ï¼šä¸“ä¸šçš„è¡¨æ ¼è¾¹æ¡†å’Œåˆ†å‰²çº¿
- **é€»è¾‘æ’¤é”€**ï¼šåŸºäºæ ‡ç­¾çš„ç²¾ç¡®æ’¤é”€æœºåˆ¶

#### 1.2.3 å¿«é€Ÿäº¤äº’ï¼šæœ€å°‘æ­¥éª¤ âš¡
- **ä¸€é”®ç¾åŒ–**ï¼š`BeautifyTable()`ç›´æ¥å¤„ç†é€‰ä¸­åŒºåŸŸ
- **æ™ºèƒ½è¯†åˆ«**ï¼šè‡ªåŠ¨æ£€æµ‹è¡¨æ ¼ç»“æ„å’Œæ•°æ®ç±»å‹
- **å³æ—¶æ’¤é”€**ï¼š`UndoBeautify()`ä¸€é”®è¿˜åŸ

### 1.3 è®¾è®¡ç›®æ ‡
- **æç®€éƒ¨ç½²**ï¼šå•æ–‡ä»¶ï¼Œé›¶é…ç½®ï¼Œå¯¼å…¥å³ç”¨
- **å¿«é€Ÿæ‰§è¡Œ**ï¼šä¸€é”®å®Œæˆï¼Œæ— å¤æ‚ç•Œé¢
- **ç¨³å®šå¯é **ï¼šç²¾ç¡®æ’¤é”€ï¼Œä¸å½±å“åŸæœ‰æ•°æ®
- **æ€§èƒ½ä¼˜åŒ–**ï¼šé’ˆå¯¹å¤§è¡¨æ ¼ä¼˜åŒ–ï¼Œé¿å…å¡é¡¿

### 1.4 æ ¸å¿ƒä»·å€¼
- 30ç§’å®Œæˆéƒ¨ç½²å’Œé¦–æ¬¡ä½¿ç”¨
- 3ç§’å®Œæˆè¡¨æ ¼ä¸“ä¸šç¾åŒ–
- èŠ‚çœ95%çš„æ‰‹åŠ¨æ ¼å¼åŒ–æ—¶é—´
- é›¶å­¦ä¹ æˆæœ¬ï¼Œå¯¼å…¥å³ä¼šç”¨

## 2. æ ¸å¿ƒåŠŸèƒ½éœ€æ±‚

### 2.1 è¡¨å¤´ç¾åŒ–åŠŸèƒ½

#### 2.1.1 è‡ªåŠ¨è¡¨å¤´è¯†åˆ«
**åŠŸèƒ½æè¿°**ï¼šåŸºäºå¤šç»´åº¦è¯„åˆ†ç®—æ³•æ™ºèƒ½è¯†åˆ«è¡¨å¤´è¡Œï¼Œåº”ç”¨ä¸“ä¸šç¾åŒ–æ•ˆæœ

**æ™ºèƒ½æ£€æµ‹ç®—æ³•**ï¼š
é‡‡ç”¨å¤šç»´åº¦è¯„åˆ†æœºåˆ¶ï¼ˆæ€»åˆ†100åˆ†ï¼Œé˜ˆå€¼60åˆ†ï¼‰ï¼š
- **æ–‡æœ¬å†…å®¹è¯„åˆ†**ï¼ˆ30åˆ†ï¼‰ï¼šå…¨éƒ¨ä¸ºæ–‡æœ¬å†…å®¹
- **å®Œæ•´æ€§è¯„åˆ†**ï¼ˆ25åˆ†ï¼‰ï¼šæ— ç©ºå•å…ƒæ ¼
- **æ ¼å¼å·®å¼‚è¯„åˆ†**ï¼ˆ20åˆ†ï¼‰ï¼šä¸æ•°æ®è¡Œæ ¼å¼æ˜¾è‘—ä¸åŒ
- **æ•°æ®ç±»å‹è¯„åˆ†**ï¼ˆ20åˆ†ï¼‰ï¼šä¸ä¸‹ä¸€è¡Œæ•°æ®ç±»å‹å·®å¼‚>50%
- **å­—ä½“æ ·å¼è¯„åˆ†**ï¼ˆ15åˆ†ï¼‰ï¼šåŠ ç²—å­—ä½“
- **èƒŒæ™¯è‰²è¯„åˆ†**ï¼ˆ10åˆ†ï¼‰ï¼šæœ‰èƒŒæ™¯é¢œè‰²è®¾ç½®

**æ£€æµ‹è§„åˆ™**ï¼š
- é€è¡Œè¯„åˆ†ï¼ˆæœ€å¤šæ£€æµ‹å‰3è¡Œï¼‰
- è¾¾åˆ°60åˆ†é˜ˆå€¼å³è®¤å®šä¸ºè¡¨å¤´è¡Œ
- è‡ªåŠ¨è¯†åˆ«å•è¡Œæˆ–å¤šè¡Œè¡¨å¤´ç»“æ„
- å…œåº•æœºåˆ¶ï¼šé¦–è¡Œåˆ†æ•°ä¸è¶³æ—¶ä»ä½œä¸ºè¡¨å¤´å¤„ç†

**ç¾åŒ–æ•ˆæœ**ï¼š
- **èƒŒæ™¯è‰²**ï¼šå•†åŠ¡è“è‰²æ¸å˜ (#1E3A8A â†’ #3B82F6)
- **å­—ä½“**ï¼šåŠ ç²—ï¼Œç™½è‰²å­—ä½“
- **è¾¹æ¡†**ï¼šåº•éƒ¨ç²—è¾¹æ¡†ï¼Œä¾§è¾¹ç»†è¾¹æ¡†

**æ ¸å¿ƒç®—æ³•ç¤ºä¾‹**ï¼š
```vba
Function DetectHeaderRange(tableRange As Range) As Range
    Dim headerScore As Long, rowNum As Long
    
    For rowNum = 1 To 3  ' æœ€å¤šæ£€æµ‹3è¡Œ
        headerScore = 0
        Set testRow = tableRange.Rows(rowNum)
        
        ' å¤šç»´åº¦è¯„åˆ†
        If IsAllText(testRow) Then headerScore = headerScore + 30        ' æ–‡æœ¬å†…å®¹
        If HasNoEmpty(testRow) Then headerScore = headerScore + 25       ' å®Œæ•´æ€§
        If HasFormatting(testRow) Then headerScore = headerScore + 20    ' æ ¼å¼å·®å¼‚
        If HasTypeDifference(testRow, nextRow) Then headerScore = headerScore + 20  ' ç±»å‹å·®å¼‚
        If HasBoldFont(testRow) Then headerScore = headerScore + 15      ' å­—ä½“æ ·å¼
        If HasBackgroundColor(testRow) Then headerScore = headerScore + 10  ' èƒŒæ™¯è‰²
        
        ' é˜ˆå€¼åˆ¤æ–­ï¼ˆ60åˆ†ï¼‰
        If headerScore < 60 Then
            Set DetectHeaderRange = tableRange.Rows("1:" & (rowNum - 1))
            Exit Function
        End If
    Next rowNum
End Function
```

### 2.2 æ¡ä»¶æ ¼å¼æ™ºèƒ½åº”ç”¨

#### 2.2.1 æ ‡å‡†æ¡ä»¶æ ¼å¼è§„åˆ™
**åŠŸèƒ½æè¿°**ï¼šåº”ç”¨æœ€å¸¸ç”¨çš„æ¡ä»¶æ ¼å¼è§„åˆ™ï¼Œé‡‡ç”¨ä¼˜å…ˆçº§ç»ˆæ­¢é€»è¾‘é¿å…æ ¼å¼å†²çª

**å†…ç½®è§„åˆ™ï¼ˆR1C1ç›¸å¯¹å¼•ç”¨æ ¼å¼ï¼‰**ï¼š
1. **é”™è¯¯å€¼æ ‡çº¢**ï¼š`=ISERROR(RC)+N(0*LEN("ELO_TAG"))` - çº¢è‰²èƒŒæ™¯æ ‡è®°é”™è¯¯
   - **ä¼˜å…ˆçº§**ï¼š1ï¼ˆæœ€é«˜ï¼‰
   - **ç»ˆæ­¢é€»è¾‘**ï¼š`StopIfTrue = True`ï¼ˆé”™è¯¯å€¼æ— éœ€å†åˆ¤æ–­å…¶ä»–æ¡ä»¶ï¼‰

2. **ç©ºå€¼æ ‡ç°**ï¼š`=ISBLANK(RC)+N(0*LEN("ELO_TAG"))` - ç°è‰²èƒŒæ™¯æé†’ç©ºå€¼
   - **ä¼˜å…ˆçº§**ï¼š2
   - **ç»ˆæ­¢é€»è¾‘**ï¼š`StopIfTrue = True`ï¼ˆç©ºå€¼æ— éœ€å†åˆ¤æ–­é‡å¤æˆ–è´Ÿæ•°ï¼‰

3. **é‡å¤å€¼æ ‡é»„**ï¼š`=AND(RC<>"",COUNTIF(C[0],RC)>1)+N(0*LEN("ELO_TAG"))` - é»„è‰²èƒŒæ™¯æ ‡è®°é‡å¤
   - **ä¼˜å…ˆçº§**ï¼š3
   - **ç»ˆæ­¢é€»è¾‘**ï¼š`StopIfTrue = False`ï¼ˆå…è®¸ä¸è´Ÿæ•°è§„åˆ™å åŠ ï¼‰

4. **è´Ÿæ•°æ ‡çº¢**ï¼š`=RC<0+N(0*LEN("ELO_TAG"))` - çº¢è‰²å­—ä½“çªå‡ºè´Ÿæ•°
   - **ä¼˜å…ˆçº§**ï¼š4ï¼ˆæœ€ä½ï¼‰
   - **ç»ˆæ­¢é€»è¾‘**ï¼š`StopIfTrue = False`ï¼ˆä»…è®¾ç½®å­—ä½“é¢œè‰²ï¼Œå¯ä¸å…¶ä»–èƒŒæ™¯è‰²å åŠ ï¼‰

**é€»è¾‘è¦†ç›–å…³ç³»è¯´æ˜**ï¼š
- **é”™è¯¯ä¼˜å…ˆåŸåˆ™**ï¼šå•å…ƒæ ¼å‡ºé”™æ—¶ï¼Œå…¶ä»–åˆ¤æ–­å¤±å»æ„ä¹‰ï¼Œç›´æ¥ç»ˆæ­¢
- **ç©ºå€¼æ¬¡ä¼˜åŸåˆ™**ï¼šç¡®è®¤ä¸ºç©ºåï¼Œæ— éœ€åˆ¤æ–­é‡å¤æ€§æˆ–æ•°å€¼ç‰¹å¾
- **å åŠ æ˜¾ç¤ºåŸåˆ™**ï¼šéç©ºçš„è´Ÿæ•°å¯ä»¥åŒæ—¶æ˜¾ç¤ºé‡å¤æ ‡è®°ï¼ˆé»„åº•ï¼‰å’Œè´Ÿæ•°æ ‡è®°ï¼ˆçº¢å­—ï¼‰

**æ€§èƒ½ä¼˜åŒ–æ•ˆæœ**ï¼š
- **è®¡ç®—å‡å°‘**ï¼šé”™è¯¯å€¼å’Œç©ºå€¼ç»ˆæ­¢åç»­è§„åˆ™ï¼Œé¿å…æ— æ•ˆè®¡ç®—
- **å¤§è¡¨ä¼˜åŒ–**ï¼šåœ¨åŒ…å«å¤§é‡ç©ºå€¼æˆ–é”™è¯¯çš„è¡¨æ ¼ä¸­ï¼Œæ€§èƒ½æå‡æ˜¾è‘—
- **è§„åˆ™å†²çªæ¶ˆé™¤**ï¼šæ˜ç¡®çš„ä¼˜å…ˆçº§é¿å…ç”¨æˆ·å›°æƒ‘çš„æ··åˆé¢œè‰²æ•ˆæœ

**åº”ç”¨ç­–ç•¥**ï¼š
```vba
Sub ApplyStandardConditionalFormat(dataRange As Range)
    Dim sessionTag As String
    sessionTag = "ELO_" & g_BeautifyHistory.SessionId
    
    ' *** å…³é”®ï¼šR1C1å¼•ç”¨é£æ ¼åˆ‡æ¢ä¿æŠ¤ ***
    Dim prevStyle As XlReferenceStyle
    prevStyle = Application.ReferenceStyle
    Application.ReferenceStyle = xlR1C1
    
    On Error GoTo ErrorHandler
    Application.EnableEvents = False
    Application.ScreenUpdating = False
    
    ' é¢„æ¸…ç†åŒæ ‡ç­¾è§„åˆ™ï¼Œç¡®ä¿å¹‚ç­‰æ€§
    ClearTaggedRules dataRange, sessionTag
    
    ' 1. é”™è¯¯å€¼æ£€æµ‹ï¼ˆä¼˜å…ˆçº§1ï¼Œç»ˆæ­¢åç»­åˆ¤æ–­ï¼‰
    With dataRange.FormatConditions.Add(xlExpression, , "=ISERROR(RC)+N(0*LEN(""" & sessionTag & """))")
        .Interior.Color = RGB(254, 226, 226)  ' æµ…çº¢èƒŒæ™¯
        .Font.Color = RGB(127, 29, 29)        ' æ·±çº¢å­—ä½“
        .Priority = 1
        .StopIfTrue = True  ' *** é”™è¯¯å€¼ç»ˆæ­¢åç»­åˆ¤æ–­ ***
    End With
    LogCFRule dataRange.Address & "|" & sessionTag
    
    ' 2. ç©ºå€¼æ ‡è®°ï¼ˆä¼˜å…ˆçº§2ï¼Œç»ˆæ­¢åç»­åˆ¤æ–­ï¼‰
    With dataRange.FormatConditions.Add(xlExpression, , "=ISBLANK(RC)+N(0*LEN(""" & sessionTag & """))")
        .Interior.Color = RGB(249, 250, 251)  ' æµ…ç°èƒŒæ™¯
        .Priority = 2
        .StopIfTrue = True  ' *** ç©ºå€¼ç»ˆæ­¢åç»­åˆ¤æ–­ ***
    End With
    LogCFRule dataRange.Address & "|" & sessionTag
    
    ' é€åˆ—åº”ç”¨é‡å¤å€¼å’Œè´Ÿæ•°æ£€æµ‹
    Dim col As Range
    For Each col In dataRange.Columns
        ' é€åˆ—é¢„æ¸…ç†ï¼Œç¡®ä¿å¤šæ¬¡è¿è¡Œçš„å¹‚ç­‰æ€§
        ClearTaggedRules col, sessionTag
        
        ' 3. é‡å¤å€¼æ£€æµ‹ï¼ˆä¼˜å…ˆçº§3ï¼Œå…è®¸å åŠ ï¼‰
        With col.FormatConditions.Add(xlExpression, , "=AND(RC<>"""",COUNTIF(C[0],RC)>1)+N(0*LEN(""" & sessionTag & """))")
            .Interior.Color = RGB(255, 251, 235)  ' æµ…é»„è‰²
            .Priority = 3
            .StopIfTrue = False  ' *** å…è®¸ä¸è´Ÿæ•°è§„åˆ™å åŠ  ***
        End With
        LogCFRule col.Address & "|" & sessionTag
        
        ' 4. è´Ÿæ•°æ£€æµ‹ï¼ˆä¼˜å…ˆçº§4ï¼Œä»…å­—ä½“é¢œè‰²ï¼Œå…è®¸å åŠ ï¼‰
        If IsNumericColumn(col) Then
            With col.FormatConditions.Add(xlExpression, , "=RC<0+N(0*LEN(""" & sessionTag & """))")
                .Font.Color = RGB(220, 38, 38)  ' çº¢è‰²å­—ä½“
                .Priority = 4
                .StopIfTrue = False  ' *** ä»…è®¾å­—ä½“è‰²ï¼Œå¯å åŠ èƒŒæ™¯è‰² ***
            End With
            LogCFRule col.Address & "|" & sessionTag
        End If
    Next col
    
CleanUp:
    ' *** æ¢å¤åŸå§‹å¼•ç”¨é£æ ¼ ***
    Application.ReferenceStyle = prevStyle
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    Exit Sub
    
ErrorHandler:
    Application.ReferenceStyle = prevStyle  ' é”™è¯¯æ—¶ä¹Ÿæ¢å¤
    MsgBox "æ¡ä»¶æ ¼å¼åº”ç”¨å¤±è´¥: " & Err.Description, vbExclamation
    Resume CleanUp
End Sub
```

### 2.3 è¡¨æ ¼è¾¹æ¡†å’Œæ ·å¼

#### 2.3.1 ä¸“ä¸šè¾¹æ¡†è®¾ç½®
**åŠŸèƒ½æè¿°**ï¼šåº”ç”¨ç»Ÿä¸€çš„ä¸“ä¸šè¾¹æ¡†æ ·å¼ï¼Œé‡‡ç”¨åˆ†å±‚é¢œè‰²è®¾è®¡å¢å¼ºè§†è§‰å±‚æ¬¡

**è¾¹æ¡†è§„èŒƒï¼ˆåˆ†å±‚è®¾è®¡ï¼‰**ï¼š
- **å¤–è¾¹æ¡†**ï¼šç²—çº¿ï¼ˆxlThickï¼‰ï¼Œæ·±ç°è‰² RGB(75, 85, 99)
- **å†…è¾¹æ¡†**ï¼šç»†çº¿ï¼ˆxlThinï¼‰ï¼Œæµ…ç°è‰² RGB(209, 213, 219)
- **è¡¨å¤´åˆ†å‰²**ï¼šåŒçº¿ï¼ˆxlDoubleï¼‰æˆ–ç²—çº¿ï¼Œä¸»è‰²è°ƒæ·±è‰²å˜ä½“
- **é¢œè‰²å±‚æ¬¡**ï¼šå¤–æ¡†â†’å†…æ¡†å½¢æˆæ·±â†’æµ…çš„è§†è§‰é€’å‡ï¼Œå¢å¼ºç«‹ä½“æ„Ÿ

**è¡¨å¤´å¼ºåŒ–åˆ†éš”**ï¼š
- **åº•éƒ¨è¾¹æ¡†æ ·å¼**ï¼šåŒçº¿ï¼ˆxlDoubleï¼‰æˆ–ä¿æŒç²—çº¿
- **é¢œè‰²é€‰æ‹©**ï¼šä¸»è‰²è°ƒçš„æ·±è‰²å˜ä½“ï¼ˆå¦‚å•†åŠ¡è“çš„æ·±è‰²ç‰ˆæœ¬ï¼‰
- **è§†è§‰æ•ˆæœ**ï¼šæ˜ç¡®åŒºåˆ†è¡¨å¤´ä¸æ•°æ®åŒºåŸŸ

```vba
Sub ApplyProfessionalBorders(tableRange As Range, headerRange As Range)
    ' === æ•°æ®åŒºåŸŸè¾¹æ¡†ï¼ˆåˆ†å±‚é¢œè‰²ï¼‰ ===
    With tableRange.Borders
        .LineStyle = xlContinuous
        .Weight = xlThin
        .Color = RGB(209, 213, 219)  ' å†…éƒ¨ç½‘æ ¼ï¼šæµ…ç°è‰²
    End With
    
    ' === å¤–è¾¹æ¡†åŠ ç²—ï¼ˆæ·±è‰²ï¼‰ ===
    Dim outerBorders As Variant
    outerBorders = Array(xlEdgeLeft, xlEdgeRight, xlEdgeTop, xlEdgeBottom)
    
    Dim i As Long
    For i = 0 To UBound(outerBorders)
        With tableRange.Borders(outerBorders(i))
            .Weight = xlThick
            .Color = RGB(75, 85, 99)    ' å¤–è¾¹æ¡†ï¼šæ·±ç°è‰²
            .LineStyle = xlContinuous
        End With
    Next i
    
    ' === è¡¨å¤´åº•éƒ¨å¼ºåŒ–åˆ†éš” ===
    If Not headerRange Is Nothing Then
        With headerRange.Borders(xlEdgeBottom)
            .LineStyle = xlDouble        ' åŒçº¿æ ·å¼
            .Weight = xlThick
            .Color = RGB(30, 58, 138)    ' ä¸»è‰²è°ƒæ·±è‰²å˜ä½“ï¼ˆæ·±è“ï¼‰
        End With
    End If
End Sub
```

**è§†è§‰å±‚æ¬¡æ•ˆæœ**ï¼š
```
è¡¨å¤´åŒºåŸŸï¼šæ·±è“åŒçº¿åº•è¾¹æ¡†ï¼ˆå¼ºåˆ†éš”ï¼‰
    â†“
æ•°æ®åŒºåŸŸï¼šæµ…ç°ç»†çº¿ç½‘æ ¼ï¼ˆæŸ”å’Œå†…åˆ†ï¼‰
    â†“
æ•´ä½“è¾¹æ¡†ï¼šæ·±ç°ç²—çº¿å¤–æ¡†ï¼ˆæ˜ç¡®è¾¹ç•Œï¼‰
```

- **å­—ä½“ä¼˜åŒ–è¯¦ç»†å‚æ•°**ï¼š
  - å­—ä½“åŠ ç²—ï¼šBold (700)
  - å­—ä½“å¤§å°ï¼šæ•°æ®è¡Œå­—å· + 1ptï¼ˆæœ€å¤§12ptï¼Œæœ€å°9ptï¼‰
  - è¡Œé«˜ï¼šè‡ªåŠ¨è°ƒæ•´ï¼ˆæœ€å°18ptï¼‰

#### 2.1.2 é¦–è¡Œå†»ç»“ â­ (ç”¨æˆ·éœ€æ±‚)
**åŠŸèƒ½æè¿°**ï¼šè‡ªåŠ¨å†»ç»“è¡¨å¤´è¡Œï¼Œæ–¹ä¾¿æµè§ˆå¤§é‡æ•°æ®

**å®ç°æ–¹å¼**ï¼š
- **å†»ç»“é€»è¾‘**ï¼š
  - å•è¡Œè¡¨å¤´ï¼šå†»ç»“ç¬¬1è¡Œ
  - å¤šè¡Œè¡¨å¤´ï¼šå†»ç»“æ‰€æœ‰è¡¨å¤´è¡Œï¼ˆæœ€å¤š3è¡Œï¼‰
  - ç»„åˆå†»ç»“ï¼šæ”¯æŒåŒæ—¶å†»ç»“é¦–è¡Œå’Œé¦–åˆ—
  
- **æ™ºèƒ½æ£€æµ‹**ï¼š
  - æ•°æ®é‡æ£€æµ‹ï¼šè¡Œæ•° > 20æ—¶è‡ªåŠ¨å»ºè®®å†»ç»“
  - åˆ—å®½æ£€æµ‹ï¼šæ€»åˆ—å®½è¶…è¿‡å±å¹•å®½åº¦æ—¶å»ºè®®å†»ç»“é¦–åˆ—
  - è®°å¿†åŠŸèƒ½ï¼šè®°ä½ç”¨æˆ·çš„å†»ç»“åå¥½

### 2.2 è¾¹æ¡†å’Œåˆ†éš”åŠŸèƒ½ï¼ˆExcelå…¼å®¹æ€§ä¼˜åŒ–ï¼‰

#### 2.2.1 æ™ºèƒ½è¾¹æ¡†è®¾ç½® â­ (é™åˆ¶ExcelåŸç”Ÿæ”¯æŒ)
**åŠŸèƒ½æè¿°**ï¼šåŸºäºExcelåŸç”Ÿè¾¹æ¡†åŠŸèƒ½çš„ä¸“ä¸šè¡¨æ ¼æ ·å¼

**è¾¹æ¡†ç±»å‹è¯´æ˜**ï¼š
- **å¤–è¾¹æ¡†**ï¼š
  - çº¿å‹ï¼šå®çº¿ã€åŒçº¿ã€ç²—çº¿ï¼ˆExcelåŸç”Ÿæ”¯æŒï¼‰
  - ç²—ç»†ï¼šMediumã€Thickï¼ˆExcelæ ‡å‡†é€‰é¡¹ï¼‰
  - é¢œè‰²ï¼šRGBè‰²å€¼ï¼ˆä¸æ”¯æŒé€æ˜åº¦ï¼‰
  - ~~åœ†è§’ï¼šExcelå•å…ƒæ ¼ä¸æ”¯æŒåœ†è§’è¾¹æ¡†~~

- **è¡¨å¤´è¾¹æ¡†**ï¼š
  - åº•éƒ¨è¾¹æ¡†ï¼šMediumã€Thick
  - æ ·å¼ï¼šå®çº¿ã€åŒçº¿
  - é¢œè‰²ï¼šåŸºäºä¸»é¢˜è‰²çš„æ·±æµ…å˜åŒ–

- **å†…éƒ¨ç½‘æ ¼**ï¼š
  - çº¿å‹ï¼šå®çº¿ã€è™šçº¿ï¼ˆExcelé™åˆ¶ï¼‰
  - ç²—ç»†ï¼šThinã€Medium
  - ~~é¢œè‰²é€æ˜åº¦ï¼šExcelä¸æ”¯æŒè¾¹æ¡†é€æ˜åº¦~~

**è§†è§‰ç­‰æ•ˆå®ç°æ–¹æ¡ˆ**ï¼š
```vba
' ä½¿ç”¨æµ…è‰²å†…å¡«å…… + åˆ†å±‚è¾¹æ¡†å®ç°"ä¼ªåœ†è§’"æ•ˆæœ
Sub ApplyLayeredBorderStyle(rng As Range)
    With rng
        ' ä¸»ä½“æµ…è‰²å¡«å……
        .Interior.Color = RGB(248, 250, 252)
        
        ' å¤–å±‚ç²—è¾¹æ¡†ï¼ˆä¸»è¾¹æ¡†ï¼‰
        .Borders(xlEdgeTop).Weight = xlThick
        .Borders(xlEdgeTop).Color = RGB(100, 116, 139)
        .Borders(xlEdgeBottom).Weight = xlThick
        .Borders(xlEdgeBottom).Color = RGB(100, 116, 139)
        .Borders(xlEdgeLeft).Weight = xlThick
        .Borders(xlEdgeLeft).Color = RGB(100, 116, 139)
        .Borders(xlEdgeRight).Weight = xlThick
        .Borders(xlEdgeRight).Color = RGB(100, 116, 139)
        
        ' å†…å±‚ç»†è¾¹æ¡†åˆ›å»ºå±‚æ¬¡æ„Ÿ
        .Borders(xlInsideHorizontal).Weight = xlThin
        .Borders(xlInsideHorizontal).Color = RGB(226, 232, 240)
        .Borders(xlInsideVertical).Weight = xlThin
        .Borders(xlInsideVertical).Color = RGB(226, 232, 240)
    End With
End Sub
```

**TableStyleç»„åˆæ–¹æ¡ˆ**ï¼š
```vba
Sub ApplyTableStyleWithBorders(tbl As ListObject)
    ' ä½¿ç”¨TableStyle + è¾¹æ¡†ç»„åˆï¼Œé¿å…ä¿®æ”¹åˆ—å®½
    tbl.TableStyle = "ELO_Business"
    
    With tbl.Range
        ' å¤–è¾¹æ¡†åŠ å¼º
        .Borders(xlEdgeTop).Weight = xlMedium
        .Borders(xlEdgeBottom).Weight = xlMedium
        .Borders(xlEdgeLeft).Weight = xlMedium
        .Borders(xlEdgeRight).Weight = xlMedium
        
        ' è¡¨å¤´åº•è¾¹æ¡†çªå‡º
        tbl.HeaderRowRange.Borders(xlEdgeBottom).Weight = xlThick
    End With
End Sub
```

**æ™ºèƒ½è¾¹æ¡†åº”ç”¨è§„åˆ™**ï¼š
- åˆå¹¶å•å…ƒæ ¼ï¼šè‡ªåŠ¨è°ƒæ•´è¾¹æ¡†ä»¥é€‚åº”åˆå¹¶åŒºåŸŸ
- ç©ºç™½å•å…ƒæ ¼ï¼šå¯é€‰æ‹©æ˜¯å¦æ·»åŠ è¾¹æ¡†
- ç­›é€‰çŠ¶æ€ï¼šä¿æŒç­›é€‰åçš„è¾¹æ¡†å®Œæ•´æ€§
- **æ€§èƒ½ä¼˜åŒ–**ï¼šæ‰¹é‡è®¾ç½®è¾¹æ¡†ï¼Œé¿å…é€å•å…ƒæ ¼æ“ä½œ

#### 2.2.2 æ–‡å­—è¾¹æ¡†æ˜¾ç¤º â­ (ç”¨æˆ·éœ€æ±‚)
**åŠŸèƒ½æè¿°**ï¼šé€šè¿‡è¾¹æ¡†çªå‡ºæ˜¾ç¤ºé‡è¦æ–‡å­—å†…å®¹

**è¾¹æ¡†æ ·å¼åº“**ï¼š
- **é‡è¦æ•°æ®**ï¼š
  - æ ·å¼ï¼šåŒçº¿æ¡†
  - é¢œè‰²ï¼š#DC2626ï¼ˆçº¢è‰²ï¼‰
  - ç²—ç»†ï¼š1.5pt
  
- **æ±‡æ€»è¡Œ**ï¼š
  - é¡¶éƒ¨è¾¹æ¡†ï¼šåŒçº¿
  - åº•éƒ¨è¾¹æ¡†ï¼šç²—çº¿
  - é¢œè‰²ï¼š#1F2937ï¼ˆæ·±ç°ï¼‰
  
- **å…³é”®æŒ‡æ ‡**ï¼ˆè§†è§‰ç­‰æ•ˆæ–¹æ¡ˆï¼‰ï¼š
  - æ ·å¼ï¼šåŒå±‚è¾¹æ¡†ï¼ˆå¤–ç²—å†…ç»†ï¼‰
  - å¡«å……ï¼šæµ…è‰²å†…å¡«å……æ¨¡æ‹Ÿé˜´å½±æ•ˆæœ
  - é¢œè‰²ï¼šæ·±æµ…è¾¹æ¡†ç»„åˆ

### 2.3 æ•°æ®çªå‡ºæ˜¾ç¤º

#### 2.3.1 è´Ÿæ•°é‡‘é¢çªå‡º â­ (ç”¨æˆ·éœ€æ±‚)
**åŠŸèƒ½æè¿°**ï¼šè‡ªåŠ¨è¯†åˆ«å¹¶çªå‡ºæ˜¾ç¤ºè´Ÿæ•°é‡‘é¢

**è¯†åˆ«è§„åˆ™**ï¼š
- æ•°å€¼ç±»å‹æ£€æµ‹ï¼šNumberã€Currencyã€Accountingæ ¼å¼
- è´Ÿå€¼åˆ¤æ–­ï¼šå€¼ < 0 æˆ–åŒ…å«è´Ÿå·
- å…¬å¼ç»“æœï¼šæ”¯æŒå…¬å¼è®¡ç®—ç»“æœçš„è´Ÿå€¼æ£€æµ‹

**æ˜¾ç¤ºæ ¼å¼è¯¦ç»†é…ç½®**ï¼š
```vba
' æ ¼å¼æ¨¡æ¿ï¼ˆä¿®æ­£è¯­æ³•ï¼‰
NegativeFormats = Array( _
    "(#,##0.00)",          ' æ‹¬å·æ ¼å¼
    "-#,##0.00",           ' è´Ÿå·æ ¼å¼
    """â–²""#,##0.00",       ' ä¸‰è§’å½¢æ ¼å¼ï¼ˆå¼•å·åŒ…å›´ï¼‰
    "[Red]-#,##0.00",      ' çº¢è‰²è´Ÿå·
    "[Red](#,##0.00)"      ' çº¢è‰²æ‹¬å·
)
```

**æ¡ä»¶æ ¼å¼è§„åˆ™**ï¼š
- è½»åº¦è´Ÿå€¼ï¼ˆ-10%ä»¥å†…ï¼‰ï¼šæµ…çº¢èƒŒæ™¯ #FEF2F2
- ä¸­åº¦è´Ÿå€¼ï¼ˆ-10%åˆ°-30%ï¼‰ï¼šä¸­çº¢èƒŒæ™¯ #FEE2E2
- é‡åº¦è´Ÿå€¼ï¼ˆ-30%ä»¥ä¸Šï¼‰ï¼šæ·±çº¢èƒŒæ™¯ #FECACA

### 2.4 è¡Œåˆ—ç¾åŒ–åŠŸèƒ½

#### 2.4.1 éš”è¡Œå˜è‰²æ–‘é©¬æ¡çº¹ â­ (ç”¨æˆ·éœ€æ±‚)
**åŠŸèƒ½æè¿°**ï¼šä¸ºè¡¨æ ¼æ·»åŠ éš”è¡ŒèƒŒæ™¯è‰²ï¼Œæå‡å¯è¯»æ€§

**æ™ºèƒ½æ¡çº¹è§„åˆ™ï¼ˆR1C1æ ¼å¼ï¼‰**ï¼š
- **è‡ªé€‚åº”æ¨¡å¼**ï¼š
  - å°è¡¨æ ¼ï¼ˆ<50è¡Œï¼‰ï¼šæ¯è¡Œäº¤æ›¿
  - ä¸­è¡¨æ ¼ï¼ˆ50-200è¡Œï¼‰ï¼šæ¯2è¡Œäº¤æ›¿
  - å¤§è¡¨æ ¼ï¼ˆ>200è¡Œï¼‰ï¼šæ¯3è¡Œäº¤æ›¿

**R1C1æ¡ä»¶æ ¼å¼å…¬å¼**ï¼š
```vba
' éš”è¡Œå˜è‰²å…¬å¼ï¼ˆR1C1æ ¼å¼ï¼‰
formula = "=MOD(ROW()-" & dataRange.Row & "+1," & (stripeStep * 2) & ")<=" & stripeStep & _
          "+N(0*LEN(""" & sessionTag & """))"
```

**é…è‰²æ–¹æ¡ˆè¯¦ç»†å‚æ•°**ï¼š
```
æµ…è‰²ç³»ï¼š
  - ä¸»è‰²ï¼š#FFFFFF (255,255,255)
  - è¾…è‰²ï¼š#F9FAFB (249,250,251)
  - æ˜åº¦è°ƒæ•´ï¼šTintAndShade = 0
  
è“è‰²ç³»ï¼š
  - ä¸»è‰²ï¼š#FFFFFF (255,255,255)
  - è¾…è‰²ï¼š#EFF6FF (239,246,255)
  - æ˜åº¦è°ƒæ•´ï¼šTintAndShade = 0.1 (ç¨å¾®å˜äº®)
  
ç»¿è‰²ç³»ï¼š
  - ä¸»è‰²ï¼š#FFFFFF (255,255,255)
  - è¾…è‰²ï¼š#F0FDF4 (240,253,244)
  - æ˜åº¦è°ƒæ•´ï¼šTintAndShade = 0.1 (ç¨å¾®å˜äº®)
```

### 2.5 å­—ä½“ç¾åŒ–åŠŸèƒ½

#### 2.5.1 å­—ä½“ç»Ÿä¸€æ ‡å‡†åŒ–
**åŠŸèƒ½æè¿°**ï¼šç»Ÿä¸€è¡¨æ ¼å­—ä½“æ ·å¼ï¼Œæå‡ä¸“ä¸šåº¦

**å­—ä½“é€‰æ‹©é€»è¾‘**ï¼š
```vba
Function SelectOptimalFont(contentType As String) As String
    Select Case contentType
        Case "ChineseHeader"
            SelectOptimalFont = "å¾®è½¯é›…é»‘"  ' ä¸­æ–‡æ ‡é¢˜
        Case "ChineseData"
            SelectOptimalFont = "å¾®è½¯é›…é»‘"  ' ç»Ÿä¸€å¾®è½¯é›…é»‘ï¼Œåˆ é™¤Lightå­—é‡
        Case "EnglishHeader"
            SelectOptimalFont = "Calibri"  ' è‹±æ–‡æ ‡é¢˜
        Case "EnglishData"
            SelectOptimalFont = "Arial"    ' è‹±æ–‡æ•°æ®
        Case "Number", "Currency", "Financial"
            ' *** æ•°å­—/é‡‘é¢ç»Ÿä¸€ç­‰å®½å­—ä½“ï¼Œä¼˜å…ˆçº§å›é€€ ***
            If IsFontAvailable("Consolas") Then
                SelectOptimalFont = "Consolas"      ' é¦–é€‰ç­‰å®½
            ElseIf IsFontAvailable("Courier New") Then
                SelectOptimalFont = "Courier New"   ' å›é€€ç­‰å®½
            ElseIf IsFontAvailable("SF Mono") Then
                SelectOptimalFont = "SF Mono"       ' Macç­‰å®½
            ElseIf IsFontAvailable("Menlo") Then
                SelectOptimalFont = "Menlo"         ' Macå›é€€
            Else
                SelectOptimalFont = "å¾®è½¯é›…é»‘"       ' æœ€ç»ˆå›é€€
            End If
        Case "Mixed"
            SelectOptimalFont = "å¾®è½¯é›…é»‘"  ' ä¸­è‹±æ··æ’ä¼˜å…ˆä¸­æ–‡å‹å¥½
    End Select
End Function
```

**å­—ä½“å¤§å°è‡ªé€‚åº”è§„åˆ™**ï¼š
- åˆ—å®½ < 10ï¼š8pt
- åˆ—å®½ 10-20ï¼š9pt
- åˆ—å®½ 20-30ï¼š10pt
- åˆ—å®½ > 30ï¼š11pt
- æœ€å¤§é™åˆ¶ï¼š12pt
- æœ€å°é™åˆ¶ï¼š8pt

### 2.4 æ ¸å¿ƒä¸»å‡½æ•°

#### 2.4.1 ä¸€é”®ç¾åŒ–ä¸»å‡½æ•°
**åŠŸèƒ½æè¿°**ï¼šå•å‡½æ•°å®Œæˆæ‰€æœ‰ç¾åŒ–æ“ä½œ

```vba
Sub BeautifyTable()
    Dim targetRange As Range
    Dim headerRange As Range
    Dim dataRange As Range
    
    ' ä¿å­˜åŸå§‹åº”ç”¨çŠ¶æ€
    Dim originalScreenUpdating As Boolean
    Dim originalCalculation As XlCalculation
    originalScreenUpdating = Application.ScreenUpdating
    originalCalculation = Application.Calculation
    
    On Error GoTo ErrorHandler
    
    ' è®¾ç½®æ€§èƒ½æ¨¡å¼
    Application.ScreenUpdating = False
    Application.Calculation = xlCalculationManual
    
    ' 1. æ™ºèƒ½æ£€æµ‹è¡¨æ ¼åŒºåŸŸ
    Set targetRange = DetectTableRange()
    If targetRange Is Nothing Then
        MsgBox "æœªæ£€æµ‹åˆ°æœ‰æ•ˆè¡¨æ ¼åŒºåŸŸï¼Œè¯·é€‰æ‹©æ•°æ®åŒºåŸŸåå†è¯•ã€‚", vbExclamation
        Exit Sub
    End If
    
    ' 2. éªŒè¯æ“ä½œ
    If Not ValidateBeautifyOperation(targetRange) Then
        Exit Sub
    End If
    
    ' 3. åˆå§‹åŒ–æ’¤é”€æ—¥å¿—
    Call InitializeBeautifyLog()
    
    ' 4. æ£€æµ‹è¡¨å¤´åŒºåŸŸ
    Set headerRange = DetectHeaderRange(targetRange)
    Set dataRange = targetRange.Offset(headerRange.Rows.Count, 0).Resize(targetRange.Rows.Count - headerRange.Rows.Count, targetRange.Columns.Count)
    
    ' 5. åº”ç”¨ç¾åŒ–
    If Not headerRange Is Nothing Then
        Call ApplyHeaderStyle(headerRange)
    End If
    Call ApplyStandardConditionalFormat(dataRange)
    Call ApplyProfessionalBorders(targetRange)
    
    ' 6. æ¢å¤åº”ç”¨çŠ¶æ€
    Application.ScreenUpdating = originalScreenUpdating
    Application.Calculation = originalCalculation
    
    MsgBox "è¡¨æ ¼ç¾åŒ–å®Œæˆï¼å¦‚éœ€æ’¤é”€ï¼Œè¯·è¿è¡Œ UndoBeautify()", vbInformation
    Exit Sub
    
ErrorHandler:
    ' é”™è¯¯æ—¶æ¢å¤åº”ç”¨çŠ¶æ€
    Application.ScreenUpdating = originalScreenUpdating
    Application.Calculation = originalCalculation
    MsgBox "ç¾åŒ–è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼š" & Err.Description, vbCritical
End Sub
```

#### 2.4.2 æ™ºèƒ½è¡¨æ ¼æ£€æµ‹
**åŠŸèƒ½æè¿°**ï¼šè‡ªåŠ¨æ£€æµ‹å½“å‰é€‰æ‹©æˆ–æ´»åŠ¨åŒºåŸŸçš„è¡¨æ ¼

```vba
Function DetectTableRange() As Range
    ' ä¼˜å…ˆä½¿ç”¨é€‰ä¸­åŒºåŸŸ
    If Not Selection Is Nothing And TypeName(Selection) = "Range" Then
        If Selection.Cells.Count > 1 Then
            Set DetectTableRange = Selection
            Exit Function
        End If
    End If
    
    ' ä½¿ç”¨å½“å‰åŒºåŸŸï¼ˆé¿å…UsedRangeçš„è„æ‰©å±•ï¼‰
    Set DetectTableRange = ActiveCell.CurrentRegion
    
    ' éªŒè¯åŒºåŸŸæœ‰æ•ˆæ€§
    If DetectTableRange.Cells.Count < 4 Then
        Set DetectTableRange = Nothing
    End If
End Function

Function DetectHeaderRange(tableRange As Range) As Range
    ' æ™ºèƒ½è¡¨å¤´æ£€æµ‹ï¼šåŸºäºå¤šç»´åº¦è¯„åˆ†ç®—æ³•
    Dim headerScore As Long, rowNum As Long
    Dim maxHeaderRows As Long
    maxHeaderRows = 3  ' æœ€å¤šæ£€æµ‹3è¡Œä½œä¸ºè¡¨å¤´
    
    ' è¯„åˆ†æ ‡å‡†
    Const SCORE_ALL_TEXT As Long = 30       ' å…¨éƒ¨ä¸ºæ–‡æœ¬
    Const SCORE_NO_EMPTY As Long = 25       ' æ— ç©ºå•å…ƒæ ¼
    Const SCORE_FORMAT_DIFF As Long = 20    ' æ ¼å¼å·®å¼‚
    Const SCORE_BOLD_FONT As Long = 15      ' åŠ ç²—å­—ä½“
    Const SCORE_BG_COLOR As Long = 10       ' èƒŒæ™¯è‰²
    Const SCORE_TYPE_DIFF As Long = 20      ' æ•°æ®ç±»å‹å·®å¼‚
    
    Dim testRows As Long
    testRows = Application.Min(maxHeaderRows, tableRange.Rows.Count)
    
    For rowNum = 1 To testRows
        headerScore = 0
        Set testRow = tableRange.Rows(rowNum)
        
        ' è¯„åˆ†é€»è¾‘
        If IsAllText(testRow) Then headerScore = headerScore + SCORE_ALL_TEXT
        If HasNoEmpty(testRow) Then headerScore = headerScore + SCORE_NO_EMPTY
        If HasFormatting(testRow) Then headerScore = headerScore + SCORE_FORMAT_DIFF
        If HasBoldFont(testRow) Then headerScore = headerScore + SCORE_BOLD_FONT
        If HasBackgroundColor(testRow) Then headerScore = headerScore + SCORE_BG_COLOR
        
        ' ä¸ä¸‹ä¸€è¡Œå¯¹æ¯”
        If rowNum < tableRange.Rows.Count Then
            If HasTypeDifference(testRow, tableRange.Rows(rowNum + 1)) Then
                headerScore = headerScore + SCORE_TYPE_DIFF
            End If
        End If
        
        ' åˆ¤æ–­æ˜¯å¦ä¸ºè¡¨å¤´ï¼ˆé˜ˆå€¼60åˆ†ï¼‰
        If headerScore < 60 Then
            If rowNum = 1 Then
                ' ç¬¬ä¸€è¡Œåˆ†æ•°ä¸å¤Ÿï¼Œé»˜è®¤ç¬¬ä¸€è¡Œä¸ºè¡¨å¤´
                Set DetectHeaderRange = tableRange.Rows(1)
            Else
                ' æ‰¾åˆ°æ•°æ®è¡Œï¼Œå‰é¢çš„è¡Œéƒ½æ˜¯è¡¨å¤´
                Set DetectHeaderRange = tableRange.Rows("1:" & (rowNum - 1))
            End If
            Exit Function
        End If
    Next rowNum
    
    ' é»˜è®¤ç¬¬ä¸€è¡Œä¸ºè¡¨å¤´
    Set DetectHeaderRange = tableRange.Rows(1)
End Function
```

### 2.5 é€»è¾‘æ’¤é”€æœºåˆ¶

#### 2.5.1 ç²¾ç¡®æ’¤é”€å®ç°
**åŠŸèƒ½æè¿°**ï¼šåŸºäºæ ‡ç­¾çš„ç²¾ç¡®æ’¤é”€ï¼Œé¿å…è¯¯åˆ ç”¨æˆ·åŸæœ‰æ ¼å¼

**å˜æ›´æ—¥å¿—ç»“æ„**ï¼š
```vba
' å…¨å±€å˜æ›´è®°å½•ï¼ˆç²¾ç¡®æ’¤é”€æœ€å°é—­ç¯å­—æ®µï¼‰
Type BeautifyLog
    SessionId As String            ' ä¼šè¯IDï¼Œç¡®ä¿åªæ’¤é”€æœ¬æ¬¡æ“ä½œ
    Timestamp As Date              ' æ“ä½œæ—¶é—´
    CFRulesAdded As String         ' æ¡ä»¶æ ¼å¼è§„åˆ™è®°å½•ï¼Œæ ¼å¼: "åœ°å€|æ ‡ç­¾;åœ°å€|æ ‡ç­¾"
    StylesAdded As String          ' æœ¬ä¼šè¯æ·»åŠ çš„æ ·å¼åç§°: "ELO_ä¸»é¢˜_SessionId;..."
    TableStylesMap As String       ' è¡¨æ ¼æ ·å¼æ˜ å°„: "è¡¨å:åŸæ ·å¼;è¡¨å:åŸæ ·å¼"
End Type

Dim g_BeautifyHistory As BeautifyLog

Sub InitializeBeautifyLog()
    g_BeautifyHistory.SessionId = Format(Now, "yyyymmddhhmmss") & "_" & Int(Rnd * 1000)
    g_BeautifyHistory.Timestamp = Now
    g_BeautifyHistory.CFRulesAdded = ""
    g_BeautifyHistory.StylesAdded = ""
    g_BeautifyHistory.TableStylesMap = ""
End Sub

Sub LogCFRule(ruleInfo As String)
    If g_BeautifyHistory.CFRulesAdded = "" Then
        g_BeautifyHistory.CFRulesAdded = ruleInfo
    Else
        g_BeautifyHistory.CFRulesAdded = g_BeautifyHistory.CFRulesAdded & ";" & ruleInfo
    End If
End Sub
```

**é€»è¾‘æ’¤é”€æœºåˆ¶ï¼ˆç²¾ç¡®æ ‡ç­¾åˆ é™¤ï¼‰**ï¼š
```vba
Sub UndoBeautify()
    Dim ws As Worksheet
    Dim styleNames() As String
    Dim cfRuleEntries() As String
    Dim tableStyleMappings() As String
    Dim i As Long, j As Long
    Dim sessionTag As String
    
    Set ws = ActiveSheet
    sessionTag = "ELO_" & g_BeautifyHistory.SessionId
    
    ' ç¡®è®¤æ’¤é”€æ“ä½œ
    If MsgBox("ç¡®å®šè¦æ’¤é”€ç¾åŒ–æ•ˆæœå—ï¼Ÿ", vbYesNo + vbQuestion) = vbNo Then
        Exit Sub
    End If
    
    Application.ScreenUpdating = False
    
    ' 1. ç²¾ç¡®åˆ é™¤å¸¦æ ‡ç­¾çš„æ¡ä»¶æ ¼å¼è§„åˆ™
    If g_BeautifyHistory.CFRulesAdded <> "" Then
        cfRuleEntries = Split(g_BeautifyHistory.CFRulesAdded, ";")
        For i = 0 To UBound(cfRuleEntries)
            Dim parts() As String
            parts = Split(cfRuleEntries(i), "|")
            If UBound(parts) = 1 Then  ' åœ°å€|æ ‡ç­¾æ ¼å¼
                Dim targetRange As Range
                Set targetRange = Range(parts(0))
                ' éå†è¯¥åŒºåŸŸçš„æ¡ä»¶æ ¼å¼ï¼Œåªåˆ é™¤åŒ…å«æˆ‘ä»¬æ ‡ç­¾çš„è§„åˆ™
                For j = targetRange.FormatConditions.Count To 1 Step -1
                    If InStr(targetRange.FormatConditions(j).Formula1, parts(1)) > 0 Then
                        targetRange.FormatConditions(j).Delete
                    End If
                Next j
            End If
        Next i
    End If
    
    ' 2. è¿˜åŸè¡¨æ ¼åŸå§‹æ ·å¼ï¼ˆæ”¯æŒå¤šè¡¨åœºæ™¯ï¼‰
    If g_BeautifyHistory.TableStylesMap <> "" Then
        tableStyleMappings = Split(g_BeautifyHistory.TableStylesMap, ";")
        For i = 0 To UBound(tableStyleMappings)
            Dim styleParts() As String
            styleParts = Split(tableStyleMappings(i), ":")
            If UBound(styleParts) = 1 Then
                Dim tableInfo() As String
                tableInfo = Split(styleParts(0), ".")
                If UBound(tableInfo) = 1 Then
                    On Error Resume Next
                    Dim targetSheet As Worksheet
                    Set targetSheet = ThisWorkbook.Worksheets(tableInfo(0))
                    Dim targetTable As ListObject
                    Set targetTable = targetSheet.ListObjects(tableInfo(1))
                    targetTable.TableStyle = styleParts(1)
                    On Error GoTo 0
                End If
            End If
        Next i
    End If
    
    ' 3. ç§»é™¤æœ¬æ¬¡ä¼šè¯åˆ›å»ºçš„è‡ªå®šä¹‰æ ·å¼ï¼ˆä»…é™æœ¬ä¼šè¯ï¼‰
    If g_BeautifyHistory.StylesAdded <> "" Then
        styleNames = Split(g_BeautifyHistory.StylesAdded, ";")
        For i = 0 To UBound(styleNames)
            On Error Resume Next
            ' ç¡®ä¿åªåˆ é™¤æœ¬æ¬¡ä¼šè¯åˆ›å»ºçš„æ ·å¼
            If InStr(styleNames(i), sessionTag) > 0 Then
                ThisWorkbook.Styles(styleNames(i)).Delete
            End If
            On Error GoTo 0
        Next i
    End If
    
    ' 4. ç§»é™¤æœ¬æ¬¡ä¼šè¯åˆ›å»ºçš„è‡ªå®šä¹‰è¡¨æ ¼æ ·å¼ï¼ˆå®‰å…¨åˆ é™¤ï¼‰
    For i = ActiveWorkbook.TableStyles.Count To 1 Step -1
        If InStr(ActiveWorkbook.TableStyles(i).Name, sessionTag) > 0 Then
            ActiveWorkbook.TableStyles(i).Delete
        End If
    Next i
    
    Application.ScreenUpdating = True
    
    ' æ¸…ç©ºå†å²è®°å½•
    InitializeBeautifyLog
    
    MsgBox "æ’¤é”€å®Œæˆï¼å·²ç§»é™¤æœ¬æ¬¡ç¾åŒ–æ ·å¼ï¼Œä¿ç•™åŸå§‹æ•°æ®ç»“æ„ã€‚", vbInformation
End Sub
```

**æ™ºèƒ½é”™è¯¯å¤„ç†**ï¼š
```vba
Function ValidateBeautifyOperation(targetRange As Range) As Boolean
    ' é¢„æ£€æŸ¥ï¼Œç¡®ä¿æ“ä½œå®‰å…¨æ€§
    If targetRange Is Nothing Then
        MsgBox "è¯·é€‰æ‹©æœ‰æ•ˆçš„æ•°æ®åŒºåŸŸ", vbExclamation
        ValidateBeautifyOperation = False
        Exit Function
    End If
    
    If targetRange.Cells.Count > 100000 Then
        If MsgBox("æ•°æ®é‡è¾ƒå¤§ï¼Œç¾åŒ–å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ", vbYesNo) = vbNo Then
            ValidateBeautifyOperation = False
            Exit Function
        End If
    End If
    
    ValidateBeautifyOperation = True
End Function
```

### 2.7 ç®€åŒ–ç¾åŒ–åŠŸèƒ½

#### 2.7.1 é¢„è®¾ç¾åŒ–ä¸»é¢˜
**åŠŸèƒ½æè¿°**ï¼šæä¾›å‡ å¥—å®ç”¨çš„é¢„è®¾ç¾åŒ–ä¸»é¢˜

**é¢„è®¾ä¸»é¢˜é…ç½®**ï¼š

1. **å•†åŠ¡ç»å…¸**
   - ä¸»è‰²è°ƒï¼šè“è‰²ç³» (#1E3A8A, #3B82F6)
   - å­—ä½“ï¼šCalibri / å¾®è½¯é›…é»‘
   - è¾¹æ¡†ï¼šç»†çº¿ç®€çº¦
   - ç‰¹ç‚¹ï¼šä¸“ä¸šã€æ¸…æ™°ã€æ˜“è¯»

2. **è´¢åŠ¡ä¸“ç”¨**
   - ä¸»è‰²è°ƒï¼šç»¿è‰²ç³» (#065F46, #10B981)
   - è­¦å‘Šè‰²ï¼šçº¢è‰² (#DC2626)
   - å­—ä½“ï¼šTimes New Roman / å®‹ä½“
   - è¾¹æ¡†ï¼šåŒçº¿è¡¨å¤´
   - ç‰¹ç‚¹ï¼šæ•°å­—æ¸…æ™°ã€æ­£è´Ÿåˆ†æ˜

3. **æç®€é£æ ¼**
   - ä¸»è‰²è°ƒï¼šé»‘ç™½ç°
   - å¼ºè°ƒè‰²ï¼šå•ä¸€å¼ºè°ƒè‰²
   - å­—ä½“ï¼šå¾®è½¯é›…é»‘ / Arial
   - è¾¹æ¡†ï¼šæ— è¾¹æ¡†æˆ–æç»†è¾¹æ¡†
   - ç‰¹ç‚¹ï¼šç®€æ´ã€ä¸“æ³¨å†…å®¹

#### 2.6.2 åŸºç¡€æ¡ä»¶æ ¼å¼
**åŠŸèƒ½æè¿°**ï¼šåº”ç”¨åŸºç¡€æ¡ä»¶æ ¼å¼è§„åˆ™

**å†…ç½®è§„åˆ™**ï¼š
- **è´Ÿæ•°çªå‡º**ï¼šçº¢è‰²å­—ä½“æ˜¾ç¤ºè´Ÿæ•°
- **é‡å¤å€¼æ ‡è®°**ï¼šæµ…é»„èƒŒæ™¯æ ‡è®°é‡å¤å€¼
- **ç©ºå€¼æé†’**ï¼šæµ…ç°èƒŒæ™¯æ ‡è®°ç©ºå€¼
- **æ•°å€¼èŒƒå›´**ï¼šåŸºäºç™¾åˆ†ä½çš„ç®€å•é¢œè‰²æ ‡è®°
### 2.9 æ¡ä»¶æ ¼å¼å¢å¼ºï¼ˆæ€§èƒ½ä¼˜åŒ–ç‰ˆï¼‰
**åŠŸèƒ½æè¿°**ï¼šé«˜æ€§èƒ½æ¡ä»¶æ ¼å¼åº”ç”¨ï¼Œé¿å…å¤§èŒƒå›´é€å•å…ƒæ ¼å¤„ç†

**æ€§èƒ½ä¼˜åŒ–è§„åˆ™**ï¼š
- **è§„åˆ™æ•°é‡é™åˆ¶**ï¼šæ¯ç±»ä¸è¶…è¿‡1æ¡å…¬å¼å‹è§„åˆ™
- **åº”ç”¨èŒƒå›´**ï¼šä»…å¯¹æ•°æ®åŒºåŸŸä¸€æ¬¡æ€§åº”ç”¨
- **åˆ†å±‚é¡ºåº**ï¼šé”™è¯¯â†’ç©ºå€¼â†’é‡å¤â†’é˜ˆå€¼â†’æ–‡æœ¬/æ—¥æœŸ

**ä¼˜åŒ–çš„è§„åˆ™ä¼˜å…ˆçº§ï¼ˆR1C1ç›¸å¯¹å¼•ç”¨è§„èŒƒï¼‰**ï¼š
1. **é”™è¯¯å€¼æ£€æµ‹** - å…¬å¼ï¼š`=ISERROR(RC)+N(0*LEN("ELO_TAG"))`
2. **ç©ºå€¼æ ‡è®°** - å…¬å¼ï¼š`=ISBLANK(RC)+N(0*LEN("ELO_TAG"))`  
3. **é‡å¤å€¼æ£€æµ‹** - é€åˆ—åº”ç”¨ï¼š`=AND(RC<>"",COUNTIF(åˆ—æ•°æ®åŒº,RC)>1)+N(0*LEN("ELO_TAG"))`ï¼ˆé™å®šæ•°æ®èŒƒå›´ï¼‰
4. **æ•°å€¼é˜ˆå€¼** - é€åˆ—åˆ¤å®šï¼š`=RC<0+N(0*LEN("ELO_TAG"))` (è´Ÿæ•°æ£€æµ‹ï¼Œä»…åº”ç”¨äºæ•°å€¼åˆ—)
5. **æ–‡æœ¬åŒ¹é…** - å…¬å¼ï¼š`=ISNUMBER(SEARCH("é”™è¯¯",RC))+N(0*LEN("ELO_TAG"))` (å…³é”®è¯æ£€æµ‹)

## 3. æ€§èƒ½å’Œå®‰å…¨ä¼˜åŒ–

### 3.1 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

#### 3.1.1 æ™ºèƒ½åŒºåŸŸæ£€æµ‹
**é¿å…UsedRangeè„æ‰©å±•é—®é¢˜**ï¼š
```vba
Function GetSmartDataRange() As Range
    Dim ws As Worksheet
    Set ws = ActiveSheet
    
    ' ä¼˜å…ˆä½¿ç”¨å½“å‰åŒºåŸŸï¼Œé¿å…UsedRangeçš„è„æ‰©å±•
    If Not Selection Is Nothing Then
        Set GetSmartDataRange = Selection.CurrentRegion
    Else
        ' ä»A1å¼€å§‹å¯»æ‰¾å®é™…æ•°æ®è¾¹ç•Œ
        Dim lastRow As Long, lastCol As Long
        lastRow = ws.Cells(ws.Rows.Count, 1).End(xlUp).Row
        lastCol = ws.Cells(1, ws.Columns.Count).End(xlToLeft).Column
        
        ' éªŒè¯è¾¹ç•Œçš„åˆç†æ€§
        If lastRow > 1 And lastCol > 1 And lastRow < 1000000 And lastCol < 16384 Then
            Set GetSmartDataRange = ws.Range(ws.Cells(1, 1), ws.Cells(lastRow, lastCol))
        Else
            Set GetSmartDataRange = ws.Range("A1:J20")  ' å®‰å…¨é»˜è®¤å€¼
        End If
    End If
End Function
```

#### 3.1.2 åº”ç”¨çŠ¶æ€ä¿æŠ¤
**å®‰å…¨çš„çŠ¶æ€ç®¡ç†**ï¼š
```vba
Type AppState
    ScreenUpdating As Boolean
    Calculation As XlCalculation
    EnableEvents As Boolean
    DisplayAlerts As Boolean
End Type

Function SaveAppState() As AppState
    Dim state As AppState
    With Application
        state.ScreenUpdating = .ScreenUpdating
        state.Calculation = .Calculation
        state.EnableEvents = .EnableEvents
        state.DisplayAlerts = .DisplayAlerts
    End With
    SaveAppState = state
End Function

Sub RestoreAppState(state As AppState)
    With Application
        .ScreenUpdating = state.ScreenUpdating
        .Calculation = state.Calculation
        .EnableEvents = state.EnableEvents
        .DisplayAlerts = state.DisplayAlerts
    End With
End Sub

Sub SetPerformanceMode()
    With Application
        .ScreenUpdating = False
        .Calculation = xlCalculationManual
        .EnableEvents = False
        .DisplayAlerts = False
    End With
End Sub
```

### 3.2 å®‰å…¨é”™è¯¯å¤„ç†

#### 3.2.1 ç»Ÿä¸€é”™è¯¯å¤„ç†æ¡†æ¶
```vba
Function SafeExecute(targetRange As Range) As Boolean
    Dim originalState As AppState
    originalState = SaveAppState()
    
    On Error GoTo ErrorHandler
    
    ' è®¾ç½®æ€§èƒ½æ¨¡å¼
    SetPerformanceMode
    
    ' æ‰§è¡Œç¾åŒ–æ“ä½œ
    Call ApplyHeaderStyle(targetRange.Rows(1))
    Call ApplyStandardConditionalFormat(targetRange)
    Call ApplyProfessionalBorders(targetRange)
    
    ' æ¢å¤çŠ¶æ€
    RestoreAppState originalState
    SafeExecute = True
    Exit Function
    
ErrorHandler:
    ' é”™è¯¯æ—¶å¼ºåˆ¶æ¢å¤çŠ¶æ€
    RestoreAppState originalState
    MsgBox "æ“ä½œå¤±è´¥ï¼š" & Err.Description & vbCrLf & "å·²æ¢å¤åŸå§‹è®¾ç½®ã€‚", vbCritical
    SafeExecute = False
End Function
```
            .Interior.Color = RGB(255, 251, 235)  ' æµ…é»„è‰²
            .StopIfTrue = False
        End With
        
        ' è´Ÿæ•°æ£€æµ‹ï¼ˆä»…æ•°å€¼åˆ—ï¼‰
        If IsNumericColumn(col) Then
            With col.FormatConditions.Add(xlCellValue, xlLess, 0)
                .Font.Color = RGB(220, 38, 38)  ' çº¢è‰²å­—ä½“
                .StopIfTrue = False
            End With
        End If
    Next col
    
    Application.EnableEvents = True
    Application.Calculation = xlCalculationAutomatic
    Application.ScreenUpdating = True
End Sub

Function IsNumericColumn(rng As Range) As Boolean
    ' å¿«é€Ÿæ£€æµ‹æ˜¯å¦ä¸ºæ•°å€¼åˆ—ï¼ˆæ£€æŸ¥å‰5ä¸ªéç©ºå•å…ƒæ ¼ï¼‰
    Dim checkCount As Integer
    For Each cell In rng
        If Not IsEmpty(cell) Then
            If IsNumeric(cell.Value) Then
                checkCount = checkCount + 1
            End If
            If checkCount >= 3 Then Exit For
        End If
    Next cell
    IsNumericColumn = (checkCount >= 3)
End Function
```

**å¤§è¡¨æ€§èƒ½æ¨¡å¼**ï¼š
- **è§¦å‘æ¡ä»¶**ï¼šæ•°æ®è¡Œæ•° > 10,000 æˆ–åˆ—æ•° > 50
- **TableStyleä¼˜å…ˆ**ï¼šå¤§æ•°æ®é›†ä½¿ç”¨å†…ç½®TableStyleè€Œéé€å•å…ƒæ ¼æ ¼å¼åŒ–
- **é™åˆ¶æªæ–½**ï¼šç¦ç”¨æ¸å˜ã€ä¼˜å…ˆå¥—ç”¨TableStyleã€ç®€åŒ–CFè§„åˆ™
- **æ‰¹å¤„ç†**ï¼šæŒ‰è¡Œå—å¤„ç†ï¼Œæ¯å—1000è¡Œ
- **å†…å­˜ä¼˜åŒ–**ï¼šä½¿ç”¨TableStyle.BandedRowsæ›¿ä»£éš”è¡Œå˜è‰²æ‰‹åŠ¨å®ç°

- **é‡å¤å€¼å¤„ç†**ï¼š
  - å®Œå…¨é‡å¤ï¼šæ·±è‰²æ ‡è®°
  - éƒ¨åˆ†é‡å¤ï¼šæµ…è‰²æ ‡è®°
  - é¦–æ¬¡å‡ºç°ï¼šä¸æ ‡è®°
  - åˆ†ç»„å†…é‡å¤ï¼šç»„å†…æ ‡è®°

- **ç©ºå€¼å¤„ç†**ï¼š
  - å¿…å¡«å­—æ®µç©ºå€¼ï¼šçº¢è‰²èƒŒæ™¯
  - å¯é€‰å­—æ®µç©ºå€¼ï¼šç°è‰²èƒŒæ™¯
  - å…¬å¼è¿”å›ç©ºï¼šé»„è‰²èƒŒæ™¯
  - æ•…æ„ç•™ç©ºï¼šä¸å¤„ç†

### 2.10 æ–°å¢åŠŸèƒ½æ¨¡å—

#### 2.10.1 æ•°æ®éªŒè¯ç¾åŒ– ğŸ†• (Excelé™åˆ¶è°ƒæ•´)
**åŠŸèƒ½æè¿°**ï¼šåœ¨ExcelåŸç”Ÿé™åˆ¶ä¸‹çš„æ•°æ®éªŒè¯ç¾åŒ–

**å®ç°å†…å®¹**ï¼š
- **~~ä¸‹æ‹‰åˆ—è¡¨ç¾åŒ–~~**ï¼š
  - ~~ä¸‹æ‹‰ç®­å¤´é¢œè‰²è‡ªå®šä¹‰~~ï¼šExcelåŸç”Ÿå¯¹è±¡ä¸å¯å®šåˆ¶
  - ~~åˆ—è¡¨é¡¹å›¾æ ‡æ”¯æŒ~~ï¼šåŸç”Ÿæ§ä»¶æ— æ³•è‡ªå®šä¹‰
  - **æ›¿ä»£æ–¹æ¡ˆ**ï¼šä½¿ç”¨å•å…ƒæ ¼èƒŒæ™¯è‰²å’Œå­—ä½“æ ·å¼åŒºåˆ†çŠ¶æ€

- **éªŒè¯æç¤ºä¼˜åŒ–**ï¼š
  - **è¾“å…¥æç¤ºæ–‡æœ¬**ï¼šä½¿ç”¨ç®€æ´æ˜ç¡®çš„æç¤ºè¯­
  - **é”™è¯¯æç¤ºæ–‡æœ¬**ï¼šå‹å¥½çš„é”™è¯¯è¯´æ˜
  - ~~æç¤ºæ¡†çš®è‚¤åŒ–~~ï¼šåŸç”ŸMessageBoxä¸å¯å®šåˆ¶

- **éªŒè¯çŠ¶æ€æŒ‡ç¤º**ï¼ˆExcelå…¼å®¹æ–¹æ¡ˆï¼‰ï¼š
```vba
Sub ApplyValidationStateStyle(cell As Range, validationState As String)
    Select Case validationState
        Case "Valid"
            ' æœ‰æ•ˆæ•°æ®ï¼šæµ…ç»¿è‰²èƒŒæ™¯ + æ·±ç»¿è¾¹æ¡†
            cell.Interior.Color = RGB(220, 252, 231)
            cell.Borders.Color = RGB(34, 197, 94)
            
        Case "Invalid"
            ' æ— æ•ˆæ•°æ®ï¼šæµ…çº¢è‰²èƒŒæ™¯ + æ·±çº¢è¾¹æ¡†
            cell.Interior.Color = RGB(254, 226, 226)
            cell.Borders.Color = RGB(239, 68, 68)
            
        Case "Pending"
            ' å¾…éªŒè¯ï¼šæµ…é»„è‰²èƒŒæ™¯ + æ©™è‰²è¾¹æ¡†
            cell.Interior.Color = RGB(255, 251, 235)
            cell.Borders.Color = RGB(245, 158, 11)
    End Select
End Sub
```

**ç®€åŒ–å»ºè®®**ï¼š
- ä¿ç•™**æç¤ºæ–‡æœ¬**å’Œ**å•å…ƒæ ¼æ ·å¼æŒ‡ç¤º**
- ç§»é™¤ä¸å¯å®ç°çš„UIå®šåˆ¶åŠŸèƒ½
- ä¸“æ³¨äºé€šè¿‡é¢œè‰²å’Œè¾¹æ¡†ä¼ è¾¾éªŒè¯çŠ¶æ€

#### 2.10.2 æ‰“å°ä¼˜åŒ–ç¾åŒ– ğŸ†• (Excelé™åˆ¶è°ƒæ•´)
**åŠŸèƒ½æè¿°**ï¼šé’ˆå¯¹æ‰“å°è¾“å‡ºçš„ä¸“é—¨ç¾åŒ–ï¼ˆä¿®æ­£Excelé™åˆ¶ï¼‰

**æ‰“å°è®¾ç½®**ï¼š
- **é¡µé¢è®¾ç½®**ï¼š
  - è‡ªåŠ¨è°ƒæ•´ç¼©æ”¾æ¯”ä¾‹
  - æ™ºèƒ½åˆ†é¡µï¼ˆé¿å…æ•°æ®æ–­è¡Œï¼‰
  - é¡µçœ‰é¡µè„šç¾åŒ–

- **æ‰“å°æ ·å¼**ï¼š
  - æ‰“å°ä¸“ç”¨é…è‰²ï¼ˆé»‘ç™½å…¼å®¹ï¼‰
  - ç½‘æ ¼çº¿è®¾ç½®
  - ~~èƒŒæ™¯æ°´å°~~ï¼šè¿èƒŒå•æ¨¡å—/é›¶ä¾èµ–åŸåˆ™ï¼Œå·²åˆ é™¤

- **åˆ†é¡µé¢„è§ˆæŒ‡å¼•**ï¼š
  - ~~å®æ—¶ç»˜åˆ¶åˆ†éš”çº¿~~ï¼šå½±å“æ€§èƒ½
  - **æ›¿ä»£æ–¹æ¡ˆ**ï¼šä½¿ç”¨åˆ†é¡µé¢„è§ˆæ¨¡å¼ + å®‰å…¨çš„è¾¹æ¡†æŒ‡ç¤º
```vba
Sub ShowPageBreaks()
    ActiveWindow.View = xlPageBreakPreview
    
    ' å®‰å…¨æ£€æŸ¥ï¼šç¡®ä¿åˆ†é¡µå­˜åœ¨
    If ActiveSheet.HPageBreaks.Count > 0 Then
        ' ç”¨è™šçº¿è¾¹æ¡†æ ‡è®°åˆ†é¡µä½ç½®
        With ActiveSheet.HPageBreaks(1).Location.Borders(xlEdgeTop)
            .LineStyle = xlDash
            .Weight = xlMedium
            .Color = RGB(128, 128, 128)
        End With
    End If
End Sub
```

#### 2.10.3 å“åº”å¼ç¾åŒ– ğŸ†•
**åŠŸèƒ½æè¿°**ï¼šæ ¹æ®æŸ¥çœ‹è®¾å¤‡è‡ªé€‚åº”ç¾åŒ–

**é€‚é…è§„åˆ™**ï¼š
- **å±å¹•å¤§å°é€‚é…**ï¼š
  - å¤§å±ï¼ˆ>1920pxï¼‰ï¼šå®Œæ•´æ˜¾ç¤ºæ‰€æœ‰ç¾åŒ–
  - ä¸­å±ï¼ˆ1366-1920pxï¼‰ï¼šæ ‡å‡†ç¾åŒ–
  - å°å±ï¼ˆ<1366pxï¼‰ï¼šç®€åŒ–ç¾åŒ–

- **ç¼©æ”¾çº§åˆ«é€‚é…**ï¼š
  - æ”¾å¤§æŸ¥çœ‹ï¼šå¢å¼ºç»†èŠ‚æ˜¾ç¤º
  - ç¼©å°æŸ¥çœ‹ï¼šç®€åŒ–å¤æ‚æ ·å¼

## 3. æŠ€æœ¯å®ç°è§„èŒƒ

## 4. æç®€APIæ¥å£è®¾è®¡

### 4.1 æ ¸å¿ƒå…¬å…±å‡½æ•°ï¼ˆä»…2ä¸ªï¼‰

```vba
' ===== æç®€æ ¸å¿ƒåŠŸèƒ½ =====
Public Sub BeautifyTable()                  ' ä¸€é”®ç¾åŒ–è¡¨æ ¼ï¼ˆä¸»å‡½æ•°ï¼‰
Public Sub UndoBeautify()                   ' ä¸€é”®æ’¤é”€ç¾åŒ–æ•ˆæœ

' ===== å†…éƒ¨å®ç°å‡½æ•° =====
Private Function DetectTableRange() As Range
Private Function DetectHeaderRange(tableRange As Range) As Range
Private Function ValidateBeautifyOperation(targetRange As Range) As Boolean
Private Function SaveAppState() As AppState
Private Sub RestoreAppState(state As AppState)
Private Sub SetPerformanceMode()
Private Function SafeExecute(targetRange As Range) As Boolean

Private Sub ApplyHeaderStyle(headerRange As Range)
Private Sub ApplyStandardConditionalFormat(dataRange As Range)
Private Sub ApplyProfessionalBorders(tableRange As Range)

Private Sub InitializeBeautifyLog()
Private Sub LogCFRule(ruleInfo As String)
```

### 4.2 ä½¿ç”¨æ–¹æ³•ï¼ˆè¶…ç®€å•ï¼‰

#### 4.2.1 åŸºæœ¬ä½¿ç”¨
1. **å¯¼å…¥æ¨¡å—**ï¼šå°†.basæ–‡ä»¶å¯¼å…¥Excel VBA
2. **é€‰æ‹©è¡¨æ ¼**ï¼šé€‰ä¸­è¦ç¾åŒ–çš„è¡¨æ ¼åŒºåŸŸï¼ˆå¯é€‰ï¼Œä¼šè‡ªåŠ¨æ£€æµ‹ï¼‰
3. **è¿è¡Œç¾åŒ–**ï¼šæŒ‰Alt+F11ï¼Œè¿è¡Œ`BeautifyTable()`
4. **æ’¤é”€ç¾åŒ–**ï¼šå¦‚éœ€æ’¤é”€ï¼Œè¿è¡Œ`UndoBeautify()`

#### 4.2.2 å¿«æ·é”®è®¾ç½®ï¼ˆå¯é€‰ï¼‰
```vba
' åœ¨ä¸ªäººå®å·¥ä½œç°¿ä¸­æ·»åŠ å¿«æ·é”®
Sub Auto_Open()
    Application.MacroOptions Macro:="BeautifyTable", _
                             Description:="ä¸€é”®ç¾åŒ–è¡¨æ ¼", _
                             Shortcut:="B"  ' Ctrl+Shift+B
End Sub
```
Private Function GetFinancialTheme() As ThemeConfig
Private Function GetMinimalTheme() As ThemeConfig

' é¢œè‰²å¤„ç†
Private Function RGBToLong(r As Integer, g As Integer, b As Integer) As Long
Private Function GetThemeColor(colorName As String, themeType As String) As Long

' æ€§èƒ½ä¼˜åŒ–
Private Sub DisableUpdates()
Private Sub EnableUpdates()
Private Sub OptimizeColumnWidths(tableRange As Range)
```

#### 3.1.2 v4.1å¢å¼ºé…ç½®æ•°æ®ç»“æ„
```vba
' ä¸»é¢˜é…ç½®ç»“æ„
Type ThemeConfig
    ThemeName As String
    PrimaryColor As Long
    SecondaryColor As Long
    AccentColor As Long
    FontName As String
    HeaderBold As Boolean
    BorderStyle As XlLineStyle
    ' v4.1æ–°å¢ï¼šæ±‡æ€»è¡Œç‰¹æ®Šæ ·å¼
    SummaryRowStyle As SummaryStyle
End Type

' v4.1æ–°å¢ï¼šæ±‡æ€»è¡Œæ ·å¼é…ç½®
Type SummaryStyle
    TopBorderWeight As XlBorderWeight
    FontBold As Boolean
    BackgroundColor As Long
    FontColor As Long
End Type

' v4.1æ–°å¢ï¼šè¡¨æ ¼å†…å®¹åˆ†æç»“æœ
Type ContentAnalysis
    SummaryRows As Collection
    TitleRows As Collection
    DataRows As Long
    HasHeaders As Boolean
    BusinessType As String  ' "Financial", "General", "Report"
End Type

' è¡¨æ ¼ä¿¡æ¯ç»“æ„
Type TableInfo
    HeaderRange As Range
    DataRange As Range
    TotalRange As Range
    HasHeaders As Boolean
    RowCount As Long
    ColumnCount As Long
End Type
```

' å†»ç»“å¤„ç†
Private Sub FreezeHeaderRow(headerRows As Integer)
Private Sub FreezePanes(row As Integer, column As Integer)

' ===== æ™ºèƒ½é…ç½®ç®¡ç† =====
Private Function LoadIntelligentConfig() As IntelligentConfig
Private Sub SaveUserPreferences(preferences As UserPreferences)
Private Function LoadDesignLibrary() As DesignLibrary
Private Sub UpdateLearningModel(userAction As UserAction)

' ===== é«˜çº§å·¥å…·å‡½æ•° =====
Private Function DetectTableRange() As Range
Private Function AnalyzeDataTypes(range As Range) As DataTypeAnalysis
Private Function CalculateColorHarmony(color1 As Long, color2 As Long) As Double
Private Function ValidateDesignConsistency(range As Range) As ConsistencyReport
Private Function OptimizeForAccessibility(range As Range) As AccessibilityReport

' ===== æ€§èƒ½ä¸è´¨é‡ä¿è¯ =====
Private Sub EnablePerformanceMode()
Private Sub OptimizeForLargeDataSets(rowCount As Long)
Private Function ValidateBeautificationResult(result As BeautificationResult) As Boolean
Private Sub LogBeautificationOperation(operation As BeautificationOperation)
```
```

### 3.3 ä¸ç°æœ‰ç³»ç»Ÿé›†æˆ

#### 3.3.1 å¢å¼ºAPIæ¥å£
```vba
' ä¸å¸ƒå±€ä¼˜åŒ–æ¨¡å—çš„é›†æˆæ¥å£
Public Sub CallBeautifyFromLayoutOptimizer(tableRange As Range)
    ' è¢«å¸ƒå±€ä¼˜åŒ–æ¨¡å—è°ƒç”¨
    Call BeautifyTable()
End Sub

' åŸºç¡€é…ç½®ä¿å­˜/åŠ è½½
Public Sub SaveUserSettings()
    ' ä¿å­˜ç”¨æˆ·åå¥½åˆ°å·¥ä½œç°¿
End Sub

Public Sub LoadUserSettings()
    ' ä»å·¥ä½œç°¿åŠ è½½ç”¨æˆ·åå¥½
End Sub
```

## 4. æ“ä½œæµç¨‹

### 4.1 ç®€åŒ–ç¾åŒ–æµç¨‹
1. **é€‰æ‹©è¡¨æ ¼** - é€‰ä¸­è¦ç¾åŒ–çš„è¡¨æ ¼åŒºåŸŸï¼ˆå¯é€‰ï¼Œä¼šè‡ªåŠ¨æ£€æµ‹ï¼‰
2. **è¿è¡Œä¸»ç¨‹åº** - æ‰§è¡Œ`BeautifyTable()`å‡½æ•°
3. **è‡ªåŠ¨ç¾åŒ–** - ç³»ç»Ÿè‡ªåŠ¨åº”ç”¨å•†åŠ¡ä¸»é¢˜ç¾åŒ–
4. **æ•ˆæœç¡®è®¤** - æŸ¥çœ‹ç»“æœï¼Œå¦‚éœ€æ’¤é”€å¯è¿è¡Œ`UndoBeautify()`

### 4.2 æ™ºèƒ½è¯†åˆ«å¤„ç†æµç¨‹
```vba
Sub EnhancedBeautifyProcess()
    ' 1. åˆå§‹åŒ–å˜æ›´æ—¥å¿—
    Call InitializeBeautifyLog()
    
    ' 2. æ™ºèƒ½å†…å®¹åˆ†æ
    Dim analysis As ContentAnalysis
    Set analysis = AnalyzeTableContent(ActiveSheet.UsedRange)
    
    ' 3. åº”ç”¨ä¸»é¢˜ç¾åŒ–
    Call ApplySelectedTheme(userOptions.SelectedTheme)
    
    ' 4. æ™ºèƒ½è¯†åˆ«å¤„ç†
    If userOptions.SmartSummary Then
        For Each row In analysis.SummaryRows
            Call ApplySummaryRowStyle(row, selectedTheme)
        Next row
    End If
    
    ' 5. å®Œæˆå¹¶åé¦ˆ
    Call ShowOperationResult(True, "Beautify")
End Sub
```

### 4.3 å®‰å…¨æ’¤é”€æµç¨‹
```vba
Sub SafeUndoProcess()
    ' 1. æ£€æŸ¥å˜æ›´æ—¥å¿—
    If g_BeautifyHistory.SessionId = "" Then
        MsgBox "æœªæ‰¾åˆ°ç¾åŒ–è®°å½•ï¼Œæ— æ³•æ’¤é”€ï¼", vbExclamation
        Exit Sub
    End If
    
    ' 2. ç”¨æˆ·ç¡®è®¤
    Call ShowUndoConfirmation()
    
    ' 3. æ‰§è¡Œæ’¤é”€
    Call UndoBeautify()
    
    ' 4. å®Œæˆåé¦ˆ
    Call ShowOperationResult(True, "Undo")
End Sub
```

## 5. éƒ¨ç½²è¦æ±‚

### 5.1 æ–‡ä»¶ç»“æ„
- `ExcelLayoutOptimizer.bas` - å•ä¸€VBAæ¨¡å—æ–‡ä»¶
- æ— éœ€å¤–éƒ¨é…ç½®æ–‡ä»¶
- æ— éœ€å®‰è£…ç¨‹åº

### 5.2 ä½¿ç”¨è¯´æ˜
1. å°†VBAä»£ç å¯¼å…¥Excelå·¥ä½œç°¿
2. è¿è¡Œ`BeautifyTable()`å‡½æ•°
3. æ ¹æ®æç¤ºé€‰æ‹©ä¸»é¢˜å³å¯

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv4.1 å•æ¨¡å—ä¼˜åŒ–ç‰ˆ  
**æ›´æ–°æ—¥æœŸ**ï¼š2025å¹´8æœˆ29æ—¥  
**è®¾è®¡ç›®æ ‡**ï¼šå•æ¨¡å—VBAå®ç°ï¼Œé€»è¾‘æ’¤é”€ï¼ŒExcelå…¼å®¹æ€§ï¼Œæ€§èƒ½ä¼˜åŒ–

#### 3.2.2 å•æ¨¡å—æ¶æ„è¯´æ˜
**è®¾è®¡åŸåˆ™**ï¼š
- **å•VBAæ¨¡å—**ï¼šä¸æ”¯æŒRibbon customUIï¼ˆéœ€è¦åŠ è½½é¡¹æ¶æ„ï¼‰
- **UserFormç•Œé¢**ï¼šæ›¿ä»£å¤æ‚Ribbonç•Œé¢
- **ç›´æ¥è°ƒç”¨**ï¼šé€šè¿‡Alt+F8æˆ–VBAç¼–è¾‘å™¨ç›´æ¥è¿è¡Œ
- **æ ¸å¿ƒåŠŸèƒ½èšç„¦**ï¼šä¸»é¢˜æ ·å¼ã€æ¡ä»¶æ ¼å¼ã€æ’¤é”€æœºåˆ¶

**è°ƒç”¨æ–¹å¼**ï¼š
```vba
' æ™ºèƒ½ç¾åŒ–å‘å¯¼çª—ä½“æ§ä»¶é…ç½®
Private Sub InitializeIntelligentWizard()
    ' === ç¬¬1æ­¥ï¼šç»“æ„åˆ†æç•Œé¢ ===
    lblStructureAnalysis.Caption = "æ­¥éª¤ 1/5: æ™ºèƒ½ç»“æ„åˆ†æ"
    
    ' æ˜¾ç¤ºåˆ†æç»“æœ
    txtAnalysisResult.Text = "æ£€æµ‹ç»“æœï¼š" & vbCrLf & _
        "â€¢ è¡¨å¤´åŒºåŸŸï¼šA1:F2 (2è¡Œè¡¨å¤´)" & vbCrLf & _
        "â€¢ æ•°æ®åŒºåŸŸï¼šA3:F500 (498è¡Œæ•°æ®)" & vbCrLf & _
        "â€¢ æ±‡æ€»è¡Œï¼šç¬¬501è¡Œ" & vbCrLf & _
        "â€¢ å‘ç°æ—¶é—´åºåˆ—ï¼šBåˆ—ä¸ºæœˆä»½æ•°æ®" & vbCrLf & _
        "â€¢ å‘ç°é¢„ç®—å¯¹æ¯”ï¼šCåˆ—é¢„ç®—ï¼ŒDåˆ—å®é™…"
    
    chkConfirmStructure.Value = True
    chkConfirmStructure.Caption = "ç¡®è®¤ç»“æ„åˆ†ææ­£ç¡®"
    
    ' === ç¬¬2æ­¥ï¼šè®¾è®¡é£æ ¼é€‰æ‹© ===
    lblStyleSelection.Caption = "æ­¥éª¤ 2/5: é€‰æ‹©è®¾è®¡é£æ ¼"
    
    ' è®¾è®¡é£æ ¼é€‰é¡¹
    cmbDesignStyle.List = Array("ç°ä»£ç®€çº¦", "æ•°æ®ä»ªè¡¨ç›˜", "è´¢åŠ¡ä¸¥è°¨", "å­¦æœ¯æŠ¥å‘Š", "è‡ªå®šä¹‰")
    cmbDesignStyle.ListIndex = 0  ' é»˜è®¤é€‰æ‹©ç°ä»£ç®€çº¦
    
    ' å“ç‰Œè‰²é€‰æ‹©
    lblBrandColor.Caption = "é€‰æ‹©å“ç‰Œä¸»è‰² (å¯é€‰)ï¼š"
    cmdBrandColorPicker.Caption = "é€‰æ‹©é¢œè‰²..."
    
    ' é…è‰²ç­–ç•¥
    optTriadic.Value = True  ' é»˜è®¤ä¸‰è‰²ç³»
    optTriadic.Caption = "ä¸‰è‰²ç³»é…è‰² (æ¨è)"
    optComplementary.Caption = "äº’è¡¥è‰²é…è‰²"
    optAnalogous.Caption = "é‚»è¿‘è‰²é…è‰²"
    optMonochromatic.Caption = "å•è‰²æ¸å˜"
    
    ' === ç¬¬3æ­¥ï¼šæ•°æ®æ´å¯Ÿ ===
    lblDataInsights.Caption = "æ­¥éª¤ 3/5: æ•°æ®æ´å¯Ÿåº”ç”¨"
    
    ' å‘ç°çš„æ•°æ®æ¨¡å¼
    lstDiscoveredPatterns.AddItem "âœ“ é¢„ç®—vså®é™…å¯¹æ¯” (Cåˆ—:Dåˆ—)"
    lstDiscoveredPatterns.AddItem "âœ“ æ—¶é—´åºåˆ—æ•°æ® (Båˆ—æœˆä»½)"
    lstDiscoveredPatterns.AddItem "âœ“ æ±‡æ€»è¡Œ (ç¬¬501è¡Œ)"
    lstDiscoveredPatterns.AddItem "âš  å¯èƒ½çš„å¼‚å¸¸å€¼ (D15å•å…ƒæ ¼)"
    
    ' åº”ç”¨é€‰é¡¹
    chkCreateVarianceAnalysis.Value = True
    chkCreateVarianceAnalysis.Caption = "åˆ›å»ºå·®å¼‚åˆ†æåˆ—"
    
    chkHighlightTimeSeries.Value = True
    chkHighlightTimeSeries.Caption = "æŒ‰å­£åº¦åˆ†ç»„æ—¶é—´åºåˆ—"
    
    chkEnhanceSummary.Value = True
    chkEnhanceSummary.Caption = "å¢å¼ºæ±‡æ€»è¡Œæ˜¾ç¤º"
    
    ' === ç¬¬4æ­¥ï¼šé¢„è§ˆç¡®è®¤ ===
    lblPreview.Caption = "æ­¥éª¤ 4/5: é¢„è§ˆæ•ˆæœ"
    
    ' é¢„è§ˆæ§ä»¶
    picPreviewBefore.BorderStyle = 1
    picPreviewAfter.BorderStyle = 1
    lblPreviewBefore.Caption = "ç¾åŒ–å‰"
    lblPreviewAfter.Caption = "ç¾åŒ–å"
    
    ' å¾®è°ƒé€‰é¡¹
    cmdFinetuneColors.Caption = "è°ƒæ•´é¢œè‰²"
    cmdFinetuneFonts.Caption = "è°ƒæ•´å­—ä½“"
    cmdFinetuneSpacing.Caption = "è°ƒæ•´é—´è·"
    
    ' === ç¬¬5æ­¥ï¼šåº”ç”¨ä¸æŠ¥å‘Š ===
    lblApplyReport.Caption = "æ­¥éª¤ 5/5: åº”ç”¨ç¾åŒ–"
    
    chkGenerateReport.Value = True
    chkGenerateReport.Caption = "ç”Ÿæˆç¾åŒ–æŠ¥å‘Š"
    
    chkShowQualityChecklist.Value = True
    chkShowQualityChecklist.Caption = "æ˜¾ç¤ºè´¨é‡æ£€æŸ¥æ¸…å•"
    
    cmdApplyBeautification.Caption = "åº”ç”¨ç¾åŒ–"
    cmdApplyBeautification.BackColor = RGB(59, 130, 246)  ' è“è‰²å¼ºè°ƒ
End Sub

' ä¼ ç»Ÿè®¾ç½®å¯¹è¯æ¡†ï¼ˆä¿æŒå…¼å®¹æ€§ï¼‰
Private Sub InitializeTraditionalSettings()
    ' ä¸»é¢˜é€‰æ‹©
    ComboBoxTheme.List = Array("ç°ä»£ç®€çº¦", "æ•°æ®ä»ªè¡¨ç›˜", "è´¢åŠ¡ä¸¥è°¨", "å­¦æœ¯æŠ¥å‘Š", "è‡ªå®šä¹‰")
    
    ' æ™ºèƒ½é¢œè‰²ç”Ÿæˆ
    GroupBoxIntelligentColor.Caption = "æ™ºèƒ½é…è‰²"
    cmdBrandColorPicker.Caption = "é€‰æ‹©å“ç‰Œè‰²"
    chkAutoGeneratePalette.Value = True
    chkAutoGeneratePalette.Caption = "è‡ªåŠ¨ç”Ÿæˆé…è‰²æ–¹æ¡ˆ"
    
    ' å­—ä½“å±‚æ¬¡
    GroupBoxTypography.Caption = "å­—ä½“å±‚æ¬¡"
    ComboBoxBaseFont.List = GetAvailableFonts()
    SpinButtonScaleRatio.Min = 1.1
    SpinButtonScaleRatio.Max = 1.5
    SpinButtonScaleRatio.Value = 1.25  ' é»„é‡‘æ¯”ä¾‹
    
    ' ä¸Šä¸‹æ–‡æ„ŸçŸ¥
    GroupBoxContextAware.Caption = "ä¸Šä¸‹æ–‡æ„ŸçŸ¥"
    chkSemanticAnalysis.Value = True
    chkSemanticAnalysis.Caption = "å¯ç”¨è¯­ä¹‰åˆ†æ"
    chkDataStorytelling.Value = True
    chkDataStorytelling.Caption = "å¯ç”¨æ•°æ®å™äº‹"
    chkSmartRecommendations.Value = True
    chkSmartRecommendations.Caption = "æ˜¾ç¤ºæ™ºèƒ½å»ºè®®"
    
    ' ä¸ªæ€§åŒ–è®¾ç½®
    GroupBoxPersonalization.Caption = "ä¸ªæ€§åŒ–"
    chkLearnPreferences.Value = True
    chkLearnPreferences.Caption = "å­¦ä¹ æˆ‘çš„åå¥½"
    cmdExportSettings.Caption = "å¯¼å‡ºè®¾ç½®"
    cmdImportSettings.Caption = "å¯¼å…¥è®¾ç½®"
    
    ' è´¨é‡ä¸æ€§èƒ½
    GroupBoxQuality.Caption = "è´¨é‡ä¸æ€§èƒ½"
    chkAccessibilityCheck.Value = True
    chkAccessibilityCheck.Caption = "å¯è®¿é—®æ€§æ£€æŸ¥"
    chkPerformanceMode.Value = False
    chkPerformanceMode.Caption = "æ€§èƒ½ä¼˜å…ˆæ¨¡å¼ï¼ˆå¤§æ•°æ®ï¼‰"
    TextBoxMaxRows.Value = "10000"
End Sub

' ç¾åŒ–æŠ¥å‘Šå¯¹è¯æ¡†
Private Sub InitializeReportDialog()
    lblReportTitle.Caption = "ç¾åŒ–å®ŒæˆæŠ¥å‘Š"
    lblReportTitle.Font.Size = 14
    lblReportTitle.Font.Bold = True
    
    ' æ“ä½œæ‘˜è¦
    txtOperationSummary.Text = "âœ… ç¾åŒ–æ“ä½œå®Œæˆ" & vbCrLf & _
        "â±ï¸ å¤„ç†æ—¶é—´ï¼š2.3ç§’" & vbCrLf & _
        "ğŸ“Š åº”ç”¨äº†ç°ä»£ç®€çº¦é£æ ¼" & vbCrLf & _
        "ğŸ¨ ä½¿ç”¨ä¸‰è‰²ç³»é…è‰²æ–¹æ¡ˆ" & vbCrLf & _
        "ğŸ“ åˆ›å»ºäº†å·®å¼‚åˆ†æåˆ—" & vbCrLf & _
        "ğŸ“ˆ åº”ç”¨äº†æ—¶é—´åºåˆ—åˆ†ç»„"
    
    ' è´¨é‡è¯„åˆ†
    lblQualityScore.Caption = "è´¨é‡è¯„åˆ†: 95/100"
    ProgressBarQuality.Value = 95
    
    ' ä¸“ä¸šæ£€æŸ¥æ¸…å•
    lstQualityChecklist.AddItem "âœ… è‰²å½©å¯¹æ¯”åº¦è¾¾æ ‡ (WCAG AAçº§)"
    lstQualityChecklist.AddItem "âœ… å­—ä½“å±‚æ¬¡æ¸…æ™°"
    lstQualityChecklist.AddItem "âœ… æ•°æ®å¯¹é½æ­£ç¡®"
    lstQualityChecklist.AddItem "âœ… é—´è·åè°ƒç»Ÿä¸€"
    lstQualityChecklist.AddItem "âš ï¸ å»ºè®®ï¼šè¡¨æ ¼è¶…é¡µï¼Œå¯å¯ç”¨å†»ç»“è¡¨å¤´"
    
    ' æ™ºèƒ½å»ºè®®
    lstRecommendations.AddItem "ğŸ’¡ Fåˆ—æ•°æ®å·®å¼‚è¾ƒå¤§ï¼Œå»ºè®®ä½¿ç”¨æ•°æ®æ¡"
    lstRecommendations.AddItem "ğŸ’¡ å¯æ·»åŠ æ¡ä»¶æ ¼å¼çªå‡ºå¼‚å¸¸å€¼"
    lstRecommendations.AddItem "ğŸ’¡ å»ºè®®ä¸ºæ‰“å°ä¼˜åŒ–é¡µé¢è®¾ç½®"
    
    cmdCloseReport.Caption = "å…³é—­"
    cmdApplyRecommendations.Caption = "åº”ç”¨å»ºè®®"
End Sub
```

### 3.3 ä¸ç°æœ‰ç³»ç»Ÿé›†æˆ

#### 3.3.1 APIæ¥å£å®šä¹‰
```vba
' ===== å…¬å…±APIæ¥å£ =====
Public Function BeautifyAPI(action As String, params As Dictionary) As Variant
    Select Case action
        Case "beautify"
            BeautifyAPI = ExecuteBeautify(params)
        Case "preview"
            BeautifyAPI = GeneratePreview(params)
        Case "undo"
            BeautifyAPI = UndoLastOperation()
        Case "getThemes"
            BeautifyAPI = GetAvailableThemes()
        Case "saveTheme"
            BeautifyAPI = SaveCustomTheme(params)
        Case "exportConfig"
            BeautifyAPI = ExportConfiguration(params)
        Case "importConfig"
            BeautifyAPI = ImportConfiguration(params)
    End Select
End Function
```
End Function

' ===== äº‹ä»¶é’©å­ =====
Public Event BeforeBeautify(ByRef Cancel As Boolean)
Public Event AfterBeautify(Success As Boolean)
Public Event ThemeChanged(ThemeName As String)
Public Event ErrorOccurred(ErrorMsg As String)
```

#### 3.3.2 å¸ƒå±€ä¼˜åŒ–é›†æˆ
```vba
' å®Œæ•´ä¼˜åŒ–æµç¨‹
Public Sub CompleteOptimization()
    Dim config As OptimizationConfig
    
    ' ç¬¬ä¸€æ­¥ï¼šå¸ƒå±€ä¼˜åŒ–
    ShowProgress "æ­£åœ¨ä¼˜åŒ–å¸ƒå±€..."
    config.LayoutOptions = GetLayoutSettings()
    Call OptimizeLayout(config.LayoutOptions)
    
    ' ç¬¬äºŒæ­¥ï¼šæ•°æ®æ¸…ç†
    ShowProgress "æ­£åœ¨æ¸…ç†æ•°æ®..."
    config.CleanOptions = GetCleanSettings()
    Call CleanData(config.CleanOptions)
    
    ' ç¬¬ä¸‰æ­¥ï¼šç¾åŒ–å¤„ç†
    ShowProgress "æ­£åœ¨ç¾åŒ–è¡¨æ ¼..."
    config.BeautifyOptions = GetBeautifySettings()
    Call BeautifyTable(config.BeautifyOptions)
    
    ' ç¬¬å››æ­¥ï¼šéªŒè¯ç»“æœ
    ShowProgress "æ­£åœ¨éªŒè¯ç»“æœ..."
    If ValidateResult() Then
        ShowComplete "ä¼˜åŒ–å®Œæˆï¼"
    Else
        ShowError "ä¼˜åŒ–è¿‡ç¨‹ä¸­å‡ºç°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ã€‚"
    End If
End Sub
```

## 4. æ“ä½œæµç¨‹è®¾è®¡

### 4.1 ç®€åŒ–ç¾åŒ–æµç¨‹
```vba
' ç›´æ¥è°ƒç”¨æ¨¡å¼ - ä¸€é”®ç¾åŒ–ï¼Œæ— UIç•Œé¢
Sub BeautifyCurrentTable()
    ' æ£€æµ‹å½“å‰é€‰åŒºæˆ–æ´»åŠ¨åŒºåŸŸ
    Dim targetRange As Range
    Set targetRange = GetCurrentTableRange()
    
    ' åº”ç”¨é»˜è®¤Businessä¸»é¢˜
    Call BeautifyTable(targetRange, "Business")
    
    ' åé¦ˆæ“ä½œç»“æœ
    Debug.Print "è¡¨æ ¼ç¾åŒ–å®Œæˆï¼Œä½¿ç”¨ UndoBeautify() å¯æ’¤é”€"
End Sub

' å‚æ•°åŒ–è°ƒç”¨æ¨¡å¼
Sub BeautifyWithOptions(themeName As String, Optional freezeHeader As Boolean = True)
    Dim targetRange As Range
    Set targetRange = GetCurrentTableRange()
    
    Call BeautifyTable(targetRange, themeName, freezeHeader)
End Sub
```

### 4.2 ç®€åŒ–æ‰¹é‡å¤„ç†
```vba
Sub BatchBeautifyAllTables()
    Dim ws As Worksheet
    Dim results As Collection
    Set results = New Collection
    
    ' éå†æ‰€æœ‰å·¥ä½œè¡¨
    For Each ws In ThisWorkbook.Worksheets
        On Error Resume Next
        
        ' å¤„ç†æœ‰æ•ˆè¡¨æ ¼
        If IsValidTable(ws) Then
            ' åº”ç”¨ç¾åŒ–
            Call BeautifyTable(ws.UsedRange, "Business")
            results.Add "å·¥ä½œè¡¨ '" & ws.Name & "' ç¾åŒ–å®Œæˆ"
        Else
            results.Add "å·¥ä½œè¡¨ '" & ws.Name & "' æ— æœ‰æ•ˆè¡¨æ ¼ï¼Œå·²è·³è¿‡"
        End If
        
        On Error GoTo 0
    Next ws
    
    ' è¾“å‡ºå¤„ç†ç»“æœ
    Dim result As Variant
    For Each result In results
        Debug.Print result
    Next result
End Sub
```

## 5. è´¨é‡æ ‡å‡†

### 5.1 æ€§èƒ½è¦æ±‚
| åŠŸèƒ½æ¨¡å— | å“åº”æ—¶é—´è¦æ±‚ | å‡†ç¡®ç‡è¦æ±‚ |
|---------|------------|-----------|
| è¡¨å¤´æ£€æµ‹ | <1ç§’ | >95% |
| ç¾åŒ–åº”ç”¨ | <2ç§’ | >98% |
| æ‰¹é‡å¤„ç† | <5ç§’/è¡¨ | >95% |

#### 5.1.3 æ™ºèƒ½ä¼˜åŒ–ç­–ç•¥
```vba
Private Sub OptimizeIntelligentPerformance(analysisComplexity As String)
    Select Case analysisComplexity
        Case "Simple"
            ' ç®€å•è¡¨æ ¼ï¼šå¿«é€Ÿæ¨¡å¼
            EnableQuickSemanticAnalysis = True
            UseBasicColorTheory = True
            SkipAdvancedRecommendations = True
            
        Case "Standard"
            ' æ ‡å‡†è¡¨æ ¼ï¼šå¹³è¡¡æ¨¡å¼
            EnableFullSemanticAnalysis = True
            UseAdvancedColorTheory = True
            EnableSmartRecommendations = True
            
        Case "Complex"
            ' å¤æ‚è¡¨æ ¼ï¼šæ·±åº¦æ¨¡å¼
            EnableDeepSemanticAnalysis = True
            UseAIColorGeneration = True
            EnableContextualRecommendations = True
            UseProgressiveProcessing = True
            
        Case "Enterprise"
            ' ä¼ä¸šçº§ï¼šä¸“ä¸šæ¨¡å¼
            EnableEnterpriseSemantics = True
            UseBrandAwareColoring = True
            EnableComplianceCheck = True
            UseDistributedProcessing = True
    End Select
End Sub
```

### 5.2 å…¼å®¹æ€§è¦æ±‚

#### 5.2.1 ç‰ˆæœ¬å…¼å®¹æ€§çŸ©é˜µ
| Excelç‰ˆæœ¬ | æ”¯æŒç¨‹åº¦ | é™åˆ¶è¯´æ˜ |
|----------|---------|----------|
| Excel 2016 | å®Œå…¨æ”¯æŒ | æ— é™åˆ¶ |
| Excel 2019 | å®Œå…¨æ”¯æŒ | æ— é™åˆ¶ |
| Excel 365 | å®Œå…¨æ”¯æŒ | æ— é™åˆ¶ |
| Excel 2013 | éƒ¨åˆ†æ”¯æŒ | ä¸æ”¯æŒæŸäº›æ¸å˜æ•ˆæœ |
| Excel 2010 | åŸºç¡€æ”¯æŒ | ä»…æ”¯æŒåŸºç¡€ç¾åŒ–åŠŸèƒ½ |
| Excel Online | æœ‰é™æ”¯æŒ | ä»…æ”¯æŒé¢œè‰²å’Œå­—ä½“è®¾ç½® |

#### 5.2.2 æ–‡ä»¶æ ¼å¼å…¼å®¹
- **.xlsx**ï¼šå®Œå…¨æ”¯æŒæ‰€æœ‰åŠŸèƒ½
- **.xlsm**ï¼šå®Œå…¨æ”¯æŒï¼ˆåŒ…æ‹¬å®ï¼‰
- **.xlsb**ï¼šæ”¯æŒï¼ˆäºŒè¿›åˆ¶æ ¼å¼ï¼‰
- **.xls**ï¼šéƒ¨åˆ†æ”¯æŒï¼ˆæ—§æ ¼å¼é™åˆ¶ï¼‰
- **.csv**ï¼šä¸æ”¯æŒï¼ˆçº¯æ–‡æœ¬æ ¼å¼ï¼‰

### 5.3 ç¨³å®šæ€§è¦æ±‚

#### 5.3.1 é”™è¯¯å¤„ç†æœºåˆ¶
```vba
Private Function SafeExecute(operation As String) As Boolean
    On Error GoTo ErrorHandler
    
    ' ä¿å­˜å½“å‰çŠ¶æ€
    SaveCurrentState
    
    ' æ‰§è¡Œæ“ä½œ
    Select Case operation
        Case "Beautify"
            ExecuteBeautification
        Case "Theme"
            ApplySelectedTheme
    End Select
    
    SafeExecute = True
    Exit Function
    
ErrorHandler:
    ' è®°å½•é”™è¯¯
    LogError Err.Number, Err.Description, operation
    
    ' æ¢å¤çŠ¶æ€
    RestoreLastState
    
    ' æ˜¾ç¤ºç”¨æˆ·å‹å¥½çš„é”™è¯¯ä¿¡æ¯
    ShowErrorMessage GetUserFriendlyMessage(Err.Number)
    
    SafeExecute = False
End Function
```

#### 5.3.2 æ•°æ®ä¿æŠ¤æªæ–½
- **é€»è¾‘æ’¤é”€**ï¼šåŸºäºå˜æ›´æ—¥å¿—ç²¾ç¡®å›æ»š
- **å…¬å¼ä¿æŠ¤**ï¼šä¿ç•™åŸå§‹å…¬å¼ä¸è¢«è¦†ç›–
- **æ•°æ®éªŒè¯**ï¼šä¿æŒæ•°æ®éªŒè¯è§„åˆ™
- **é“¾æ¥ä¿æŠ¤**ï¼šä¸ç ´åå¤–éƒ¨é“¾æ¥
- **å›¾è¡¨ä¿æŠ¤**ï¼šä¸å½±å“å…³è”å›¾è¡¨

### 5.2 æ ¸å¿ƒä»·å€¼æ€»ç»“

#### 6.1.1 æ™ºèƒ½é»˜è®¤å€¼
```vba
Private Function GetSmartDefaults(tableRange As Range) As BeautificationConfig
    Dim config As BeautificationConfig
    
    ' æ ¹æ®è¡¨æ ¼å¤§å°é€‰æ‹©ä¸»é¢˜
    If tableRange.Rows.Count > 1000 Then
        config.SelectedTheme = "æç®€é£æ ¼"  ' å¤§æ•°æ®é‡ä½¿ç”¨ç®€æ´ä¸»é¢˜
    ElseIf IsFinancialData(tableRange) Then
        config.SelectedTheme = "è´¢åŠ¡ä¸“ç”¨"  ' è´¢åŠ¡æ•°æ®ä½¿ç”¨ä¸“ç”¨ä¸»é¢˜
    Else
        config.SelectedTheme = "å•†åŠ¡ç»å…¸"  ' é»˜è®¤å•†åŠ¡ä¸»é¢˜
    End If
    
    ' æ ¹æ®åˆ—æ•°å†³å®šæ˜¯å¦å†»ç»“
    config.FreezeHeader = (tableRange.Columns.Count > 10)
    
    ' æ ¹æ®æ•°æ®å¯†åº¦å†³å®šæ¡çº¹
    config.ZebraStripes = (tableRange.Rows.Count > 20)
    
    Set GetSmartDefaults = config
End Function
```

#### 6.1.2 æ“ä½œå¼•å¯¼
- **é¦–æ¬¡ä½¿ç”¨å‘å¯¼**ï¼š3æ­¥å®Œæˆè®¾ç½®
- **å·¥å…·æç¤º**ï¼šé¼ æ ‡æ‚¬åœæ˜¾ç¤ºåŠŸèƒ½è¯´æ˜
- **æ™ºèƒ½å»ºè®®**ï¼šåŸºäºæ•°æ®ç‰¹å¾æ¨èè®¾ç½®
- **å¿«æ·é”®æ”¯æŒ**ï¼šå¸¸ç”¨åŠŸèƒ½å¿«æ·é”®

### 6.2 ä¸ªæ€§åŒ–æ”¯æŒ

#### 6.2.1 ç”¨æˆ·é…ç½®æ–‡ä»¶
```vba
Private Type UserProfile
    UserID As String
    PreferredTheme As String
    RecentThemes(5) As String
    CustomThemes As Collection
    FrequentSettings As Dictionary
    LastUsedDate As Date
    UsageCount As Long
End Type
```

#### 6.2.2 å­¦ä¹ ç”¨æˆ·ä¹ æƒ¯
- è®°å½•ç”¨æˆ·é€‰æ‹©é¢‘ç‡
- è‡ªåŠ¨è°ƒæ•´é»˜è®¤å€¼
- ä¸ªæ€§åŒ–æ¨è
- æ™ºèƒ½é¢„è®¾ç®¡ç†

### 6.3 å¸®åŠ©å’ŒæŒ‡å¯¼

#### 6.3.1 å†…ç½®å¸®åŠ©ç³»ç»Ÿ
```vba
Private Sub ShowContextHelp(feature As String)
    Select Case feature
        Case "GradientFill"
            ShowTooltip "æ¸å˜å¡«å……å¯ä»¥è®©è¡¨å¤´æ›´åŠ é†’ç›®ï¼Œå»ºè®®ä½¿ç”¨åŒè‰²ç³»æ¸å˜"
        Case "NegativeHighlight"
            ShowTooltip "è´Ÿæ•°é«˜äº®æœ‰åŠ©äºå¿«é€Ÿè¯†åˆ«å¼‚å¸¸æ•°æ®ï¼Œæ¨èä½¿ç”¨çº¢è‰²"
        Case "ZebraStripes"
            ShowTooltip "æ–‘é©¬æ¡çº¹å¯ä»¥æé«˜å¤§è¡¨æ ¼çš„å¯è¯»æ€§ï¼Œå»ºè®®è¡Œæ•°>20æ—¶ä½¿ç”¨"
    End Select
End Sub
```

#### 6.3.2 ç¤ºä¾‹åº“
- **è¡Œä¸šæ¨¡æ¿**ï¼šå„è¡Œä¸šæ ‡å‡†è¡¨æ ¼æ¨¡æ¿
- **åœºæ™¯ç¤ºä¾‹**ï¼šä¸åŒä½¿ç”¨åœºæ™¯çš„æœ€ä½³å®è·µ
- **æ•ˆæœå¯¹æ¯”**ï¼šç¾åŒ–å‰åå¯¹æ¯”å±•ç¤º
- **è§†é¢‘æ•™ç¨‹**ï¼šå…³é”®åŠŸèƒ½æ“ä½œè§†é¢‘

## 7. æµ‹è¯•è¦æ±‚

### 7.1 åŠŸèƒ½æµ‹è¯•ç”¨ä¾‹

#### 7.1.1 åŸºç¡€åŠŸèƒ½æµ‹è¯•
| æµ‹è¯•é¡¹ | æµ‹è¯•æ­¥éª¤ | é¢„æœŸç»“æœ |
|-------|---------|----------|
| è¡¨å¤´è¯†åˆ« | é€‰æ‹©åŒ…å«è¡¨å¤´çš„è¡¨æ ¼ | æ­£ç¡®è¯†åˆ«è¡¨å¤´è¡Œ |
| ä¸»é¢˜åº”ç”¨ | é€‰æ‹©ä¸åŒä¸»é¢˜ | ä¸»é¢˜æ­£ç¡®åº”ç”¨ |
| è¾¹æ¡†è®¾ç½® | åº”ç”¨å„ç§è¾¹æ¡†æ ·å¼ | è¾¹æ¡†æ˜¾ç¤ºæ­£å¸¸ |
| é¢œè‰²è®¾ç½® | è®¾ç½®è‡ªå®šä¹‰é¢œè‰² | é¢œè‰²æ­£ç¡®æ˜¾ç¤º |
| æ’¤é”€æ“ä½œ | æ‰§è¡Œæ’¤é”€ | æ¢å¤åˆ°ä¸Šä¸€çŠ¶æ€ |

#### 7.1.2 è¾¹ç•Œæ¡ä»¶æµ‹è¯•
- ç©ºè¡¨æ ¼å¤„ç†
- å•è¡Œ/å•åˆ—è¡¨æ ¼
- è¶…å¤§è¡¨æ ¼ï¼ˆ>100000è¡Œï¼‰
- åŒ…å«åˆå¹¶å•å…ƒæ ¼
- åŒ…å«å›¾ç‰‡/å›¾è¡¨
- åŒ…å«æ•°æ®é€è§†è¡¨

### 7.2 æ€§èƒ½æµ‹è¯•

#### 7.2.1 æ€§èƒ½æµ‹è¯•åœºæ™¯
```vba
Private Sub PerformanceTest()
    Dim testSizes() As Long
    testSizes = Array(100, 1000, 5000, 10000, 50000, 100000)
    
    For Each size In testSizes
        ' ç”Ÿæˆæµ‹è¯•æ•°æ®
        GenerateTestData size
        
        ' è®°å½•å¼€å§‹æ—¶é—´
        startTime = Timer
        
        ' æ‰§è¡Œç¾åŒ–
        BeautifyTable
        
        ' è®°å½•ç»“æŸæ—¶é—´
        endTime = Timer
        
        ' è®°å½•ç»“æœ
        LogPerformance size, endTime - startTime
    Next
End Sub
```

### 7.4 æ€§èƒ½æ¨¡å¼ä¼˜åŒ–

#### 7.4.1 å¤§è¡¨æ€§èƒ½æ¨¡å¼
**è§¦å‘æ¡ä»¶**ï¼š
- æ•°æ®è¡Œæ•° > 10,000
- åˆ—æ•° > 50
- æ–‡ä»¶å¤§å° > 50MB

**æ€§èƒ½é™åˆ¶ç­–ç•¥**ï¼š
```vba
Sub EnablePerformanceMode(ws As Worksheet)
    Dim dataRange As Range
    Set dataRange = GetDataRange(ws)
    
    ' æ£€æµ‹æ˜¯å¦éœ€è¦æ€§èƒ½æ¨¡å¼
    If dataRange.Rows.Count > 10000 Or dataRange.Columns.Count > 50 Then
        
        ' 1. é™åˆ¶æ¡ä»¶æ ¼å¼è§„åˆ™æ•°é‡
        ClearExcessiveConditionalFormats dataRange
        
        ' 2. ç¦ç”¨æ¸å˜æ•ˆæœ
        DisableGradientEffects dataRange
        
        ' 3. åªå¥—ç”¨TableStyle
        ApplyTableStyleOnly dataRange
        
        ' 4. æŒ‰è¡Œå—æ‰¹å¤„ç†
        ProcessInBatches dataRange, 1000
        
        MsgBox "å·²å¯ç”¨æ€§èƒ½æ¨¡å¼ï¼šé™åˆ¶ç¾åŒ–æ•ˆæœä»¥æå‡æ€§èƒ½", vbInformation
    End If
End Sub

Sub ProcessInBatches(dataRange As Range, batchSize As Long)
    Dim i As Long
    Dim batchRange As Range
    
    Application.ScreenUpdating = False
    Application.Calculation = xlCalculationManual
    Application.EnableEvents = False
    
    For i = 1 To dataRange.Rows.Count Step batchSize
        Set batchRange = dataRange.Rows(i).Resize(Application.Min(batchSize, dataRange.Rows.Count - i + 1))
        
        ' æ‰¹é‡åº”ç”¨ç®€åŒ–æ ·å¼
        ApplySimplifiedStyle batchRange
        
        ' è¿›åº¦æç¤º
        If i Mod 5000 = 0 Then
            Application.StatusBar = "å¤„ç†è¿›åº¦: " & Format(i / dataRange.Rows.Count, "0%")
        End If
    Next i
    
    Application.EnableEvents = True
    Application.Calculation = xlCalculationAutomatic
    Application.ScreenUpdating = True
    Application.StatusBar = False
End Sub
```

#### 7.4.2 å•æ¨¡å—æ¶æ„è¯´æ˜
**è®¾è®¡åŸåˆ™**ï¼š
- ç§»é™¤Ribbonè‡ªå®šä¹‰æ ‡ç­¾ï¼ˆå¤æ‚UIï¼‰
- å–æ¶ˆäº”æ­¥å‘å¯¼ï¼ˆç®€åŒ–ä¸ºç›´æ¥æ‰§è¡Œï¼‰
- å»é™¤æŠ¥å‘Šå¯¹è¯æ¡†ï¼ˆé‡UIåŠŸèƒ½ï¼‰
- ä¿ç•™æ ¸å¿ƒåŠŸèƒ½ï¼šä¸»é¢˜æ ·å¼ã€åŸºç¡€CFã€æ‰“å°é¢„è®¾

**Liteç‰ˆæœ¬åŠŸèƒ½æ¸…å•**ï¼š
```vba
' === å•æ¨¡å—æ ¸å¿ƒåŠŸèƒ½ ===
Sub BeautifyLite()
    ' 1. ä¸»é¢˜æ ·å¼åº”ç”¨
    ApplyThemeStyles ActiveSheet
    
    ' 2. åŸºç¡€æ¡ä»¶æ ¼å¼
    ApplyBasicConditionalFormat ActiveSheet
    
    ' 3. æ‰“å°é¢„è®¾
    SetupPrintLayout ActiveSheet
    
    ' 4. é€»è¾‘æ’¤é”€æ”¯æŒ
    InitializeBeautifyLog
End Sub

' === æ€§èƒ½ä¼˜å…ˆçš„å®ç° ===
Sub ApplyThemeStyles(ws As Worksheet)
    ' åªåº”ç”¨TableStyleï¼Œé¿å…é€å•å…ƒæ ¼æ“ä½œ
    For Each tbl In ws.ListObjects
        tbl.TableStyle = "ELO_Business"
    Next tbl
End Sub
```

## 8. éƒ¨ç½²å’Œç»´æŠ¤ï¼ˆå•æ¨¡å—ç‰ˆï¼‰

### 8.1 å•æ¨¡å—éƒ¨ç½²æ–¹æ¡ˆ

#### 8.1.1 ç®€åŒ–éƒ¨ç½²ç»“æ„
```
ExcelLayoutOptimizer_v4.1/
â”œâ”€â”€ ExcelLayoutOptimizer.bas   # å•ä¸€VBAæ¨¡å—æ–‡ä»¶
â”œâ”€â”€ README.md                  # ä½¿ç”¨è¯´æ˜
â”œâ”€â”€ Install_Guide.txt          # å¯¼å…¥æŒ‡å—
â””â”€â”€ Sample_Data.xlsx           # ç¤ºä¾‹æ•°æ®
```

**å¯¼å…¥æ­¥éª¤**ï¼š
1. æ‰“å¼€Excelï¼ŒæŒ‰ Alt+F11 è¿›å…¥VBAç¼–è¾‘å™¨
2. å³é”®ç‚¹å‡»VBAProjectï¼Œé€‰æ‹©"å¯¼å…¥æ–‡ä»¶"
3. é€‰æ‹© ExcelLayoutOptimizer.bas æ–‡ä»¶
4. æŒ‰ Alt+F8 è¿è¡Œ `BeautifyLite` å‡½æ•°

#### 8.1.2 å•æ¨¡å—ä¼˜åŠ¿
- **å³æ’å³ç”¨**ï¼šå•æ–‡ä»¶å¯¼å…¥ï¼Œæ— éœ€å®‰è£…ç¨‹åº
- **å…¼å®¹æ€§å¼º**ï¼šæ”¯æŒæ‰€æœ‰Excelç‰ˆæœ¬ï¼ˆ2013+ï¼‰
- **ä½“ç§¯å°å·§**ï¼š<50KBï¼Œå¿«é€Ÿä¼ è¾“
- **ç»´æŠ¤ç®€å•**ï¼šä¸€ä¸ªæ–‡ä»¶åŒ…å«æ‰€æœ‰åŠŸèƒ½
- **å®‰å…¨å¯æ§**ï¼šç”¨æˆ·å¯æŸ¥çœ‹æ‰€æœ‰ä»£ç ï¼Œé€æ˜åº¦é«˜

### 8.3 åŠŸèƒ½ç²¾ç®€è¯´æ˜

#### 8.3.1 ç§»é™¤çš„å¤æ‚åŠŸèƒ½
- ~~UserFormç•Œé¢~~ï¼šé¿å…å¤æ‚éƒ¨ç½²
- ~~ä¸»é¢˜é€‰æ‹©ç•Œé¢~~ï¼šç®€åŒ–ä¸ºå›ºå®šå•†åŠ¡ä¸»é¢˜
- ~~äº”æ­¥å‘å¯¼ç•Œé¢~~ï¼šç®€åŒ–ä¸ºç›´æ¥æ‰§è¡Œ  
- ~~æŠ¥å‘Šå¯¹è¯æ¡†~~ï¼šé‡UIåŠŸèƒ½ç§»é™¤
- ~~å¤–éƒ¨ä¸»é¢˜æ–‡ä»¶~~ï¼šå†…ç½®åœ¨VBAä»£ç ä¸­

#### 8.3.2 ä¿ç•™çš„æ ¸å¿ƒåŠŸèƒ½
- âœ… å›ºå®šå•†åŠ¡ä¸»é¢˜æ ·å¼ï¼ˆBusinessï¼‰
- âœ… åŸºç¡€æ¡ä»¶æ ¼å¼ï¼ˆé”™è¯¯/ç©ºå€¼/è´Ÿæ•°æ£€æµ‹ï¼‰
- âœ… æ‰“å°é¢„è®¾ï¼ˆé¡µé¢è®¾ç½®/åˆ†é¡µä¼˜åŒ–ï¼‰
- âœ… é€»è¾‘æ’¤é”€æœºåˆ¶ï¼ˆæ ·å¼ç§»é™¤ï¼Œéå·¥ä½œè¡¨å¤åˆ¶ï¼‰
- âœ… æ€§èƒ½æ¨¡å¼ï¼ˆå¤§è¡¨ä¼˜åŒ–ï¼‰

## 5. éƒ¨ç½²å’Œä½¿ç”¨æŒ‡å—

### 5.1 æç®€éƒ¨ç½²æ–¹æ¡ˆ

#### 5.1.1 30ç§’éƒ¨ç½²æµç¨‹
1. **ä¸‹è½½æ–‡ä»¶**ï¼šè·å– `ExcelTableBeautifier.bas` æ–‡ä»¶
2. **å¯¼å…¥æ¨¡å—**ï¼šåœ¨Excelä¸­æŒ‰Alt+F11ï¼Œå³é”®æ’å…¥æ¨¡å—ï¼Œå¯¼å…¥.basæ–‡ä»¶
3. **ç«‹å³ä½¿ç”¨**ï¼šé€‰æ‹©è¡¨æ ¼ï¼Œè¿è¡Œ`BeautifyTable()`

#### 5.1.2 å®‰å…¨è¯´æ˜
- **æ— ç½‘ç»œè®¿é—®**ï¼šçº¯æœ¬åœ°è¿è¡Œï¼Œä¸è¿æ¥å¤–éƒ¨æœåŠ¡å™¨
- **ä¸è‡ªåŠ¨æ›´æ–°**ï¼šé¿å…ä¼ä¸šç¯å¢ƒå®‰å…¨é£é™©
- **çº¯VBAä»£ç **ï¼šç”¨æˆ·å¯å®Œå…¨æŸ¥çœ‹å’Œå®¡æ ¸ä»£ç 
- **æ— æ³¨å†Œè¡¨ä¿®æ”¹**ï¼šä¸å½±å“ç³»ç»Ÿè®¾ç½®

## 9. é™„å½•

### 9.1 å®Œæ•´é¢œè‰²è§„èŒƒ
| é¢œè‰²åç§° | åå…­è¿›åˆ¶ | RGBå€¼ | HSLå€¼ | ç”¨é€” |
|---------|----------|-------|-------|------|
| ä¸»è“è‰² | #1E3A8A | (30,58,138) | (215,64%,33%) | è¡¨å¤´ä¸»è‰² |
| æµ…è“è‰² | #3B82F6 | (59,130,246) | (217,91%,60%) | è¡¨å¤´æ¸å˜ |
| æ·±è“è‰² | #1E40AF | (30,64,175) | (221,71%,40%) | è¾¹æ¡†å¼ºè°ƒ |
| è­¦å‘Šçº¢ | #DC2626 | (220,38,38) | (0,71%,51%) | è´Ÿæ•°/é”™è¯¯ |
| æˆåŠŸç»¿ | #10B981 | (16,185,129) | (160,84%,39%) | æ­£æ•°/æˆåŠŸ |
| ä¸­æ€§ç° | #6B7280 | (107,114,128) | (220,9%,46%) | è¾¹æ¡†/åˆ†éš” |
| æµ…ç°è‰² | #F3F4F6 | (243,244,246) | (220,14%,96%) | æ¡çº¹èƒŒæ™¯ |
| æ·±ç°è‰² | #374151 | (55,65,81) | (217,19%,27%) | æ–‡å­—/è¾¹æ¡† |

### 9.2 å­—ä½“è§„èŒƒè¯¦ç»†
| å­—ä½“åç§° | å­—é‡ | å¤§å°èŒƒå›´ | è¡Œé«˜ | å­—ç¬¦é—´è· | é€‚ç”¨åœºæ™¯ |
|---------|------|---------|------|----------|---------|
| å¾®è½¯é›…é»‘ | Regular/Bold | 8-12pt | 1.5 | 0 | ä¸­æ–‡å†…å®¹ |
| å¾®è½¯é›…é»‘ | Regular | 8-11pt | 1.5 | 0 | ä¸­æ–‡æ•°æ® |
| Calibri | Regular/Bold | 8-12pt | 1.4 | 0 | è‹±æ–‡å†…å®¹ |
| Arial | Regular/Bold | 8-11pt | 1.4 | 0 | é€šç”¨å†…å®¹ |
| Consolas | Regular | 8-10pt | 1.3 | -0.5 | æ•°å­—/ä»£ç  |
| Times New Roman | Regular | 9-11pt | 1.4 | 0 | é‡‘é¢æ•°å­— |

### 9.3 å¿«æ·é”®åˆ—è¡¨
| å¿«æ·é”® | åŠŸèƒ½ | è¯´æ˜ |
|--------|------|------|
| Ctrl+Shift+B | ä¸€é”®ç¾åŒ– | åº”ç”¨é»˜è®¤ä¸»é¢˜ |
| Ctrl+Shift+T | ä¸»é¢˜é€‰æ‹© | æ‰“å¼€ä¸»é¢˜èœå• |
| Ctrl+Shift+Z | æ’¤é”€ç¾åŒ– | æ¢å¤åŸå§‹æ ·å¼ |
| Ctrl+Shift+S | ä¿å­˜ä¸»é¢˜ | ä¿å­˜å½“å‰è®¾ç½®ä¸ºä¸»é¢˜ |
| Ctrl+Shift+P | é¢„è§ˆæ•ˆæœ | é¢„è§ˆç¾åŒ–æ•ˆæœ |
| Ctrl+Shift+H | å¸®åŠ©æ–‡æ¡£ | æ‰“å¼€å¸®åŠ© |

### 9.4 é”™è¯¯ä»£ç è¯´æ˜
| é”™è¯¯ä»£ç  | é”™è¯¯æè¿° | è§£å†³æ–¹æ¡ˆ |
|---------|---------|----------|
| E001 | æœªé€‰æ‹©æœ‰æ•ˆè¡¨æ ¼ | è¯·é€‰æ‹©åŒ…å«æ•°æ®çš„è¡¨æ ¼åŒºåŸŸ |
| E002 | è¡¨æ ¼ç»“æ„å¼‚å¸¸ | æ£€æŸ¥æ˜¯å¦æœ‰åˆå¹¶å•å…ƒæ ¼å½±å“ |
| E003 | å†…å­˜ä¸è¶³ | å…³é—­å…¶ä»–ç¨‹åºæˆ–åˆ†æ‰¹å¤„ç† |
| E004 | ä¸»é¢˜æ–‡ä»¶æŸå | é‡æ–°ä¸‹è½½ä¸»é¢˜æ–‡ä»¶ |
| E005 | ç‰ˆæœ¬ä¸å…¼å®¹ | å‡çº§Excelæˆ–ä½¿ç”¨å…¼å®¹æ¨¡å¼ |

### 5.2 æ ¸å¿ƒä»·å€¼æ€»ç»“

**æç®€é«˜æ•ˆ**ï¼š
- 30ç§’å®Œæˆéƒ¨ç½²
- 3ç§’å®Œæˆç¾åŒ–
- æ•ˆç‡æå‡ï¼š95%æ—¶é—´èŠ‚çœ

**ç¨³å®šå¯é **ï¼š
- ç²¾ç¡®æ’¤é”€æœºåˆ¶ï¼Œä¸è¯¯åˆ ç”¨æˆ·åŸæœ‰æ ¼å¼
- é”™è¯¯æ¢å¤ä¿æŠ¤ï¼Œç¡®ä¿ExcelçŠ¶æ€å®‰å…¨
- çº¯æœ¬åœ°è¿è¡Œï¼Œæ— å®‰å…¨é£é™©

**ä¸“ä¸šå®ç”¨**ï¼š
- å•†åŠ¡çº§ç¾åŒ–æ•ˆæœ
- é€‚é…å„ç§è¡¨æ ¼åœºæ™¯
- é›¶å­¦ä¹ æˆå¿ƒ

### 5.3 æŠ€æœ¯æ¶æ„æ ¸å¿ƒè¦ç‚¹

**R1C1ç»Ÿä¸€æ¶æ„**ï¼š
- ç³»ç»Ÿå†…éƒ¨ç»Ÿä¸€ä½¿ç”¨R1C1å¼•ç”¨é£æ ¼è¿›è¡Œè§£æ
- é¿å…åˆ—å­—æ¯è§£æçš„è„†å¼±æ€§ï¼Œæ”¯æŒè·¨åˆ—åŒºåŸŸæ“ä½œ
- æ‰€æœ‰æ¡ä»¶æ ¼å¼å…¬å¼å‡ä¸ºR1C1æ ¼å¼ï¼Œç¡®ä¿ç¨³å®šæ€§

**ç²¾ç¡®æ’¤é”€æœºåˆ¶**ï¼š
- åŸºäºä¼šè¯æ ‡ç­¾çš„æ¡ä»¶æ ¼å¼ç²¾ç¡®åˆ é™¤
- æœ€å°é—­ç¯å­—æ®µè®¾è®¡ï¼Œä»…ä¿ç•™å¿…è¦çš„æ’¤é”€ä¿¡æ¯
- ä¿æŠ¤ç”¨æˆ·æ—¢æœ‰æ ¼å¼ï¼Œä»…æ¸…ç†æœ¬æ¬¡ç¾åŒ–å†…å®¹

**æ€§èƒ½ä¼˜åŒ–ç­–ç•¥**ï¼š
- é€åˆ—é¢„æ¸…ç†ç¡®ä¿å¹‚ç­‰æ€§ï¼Œæ”¯æŒé‡å¤è¿è¡Œ
- å¤§è¡¨æ€§èƒ½æ¨¡å¼è‡ªåŠ¨ç®€åŒ–å¤æ‚æ ·å¼
- æ‰¹é‡æ“ä½œå’ŒçŠ¶æ€ç®¡ç†æå‡å¤„ç†æ•ˆç‡

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv4.2 (æç®€éƒ¨ç½²ç‰ˆ)  
**åˆ›å»ºæ—¥æœŸ**ï¼š2024å¹´12æœˆ29æ—¥  
**æç®€é‡æ„**ï¼š2025å¹´8æœˆ29æ—¥  
**æœ€ç»ˆä¿®è®¢**ï¼š2025å¹´9æœˆ3æ—¥ï¼ˆR1C1ç»Ÿä¸€æ¶æ„ï¼‰  
**è®¾è®¡ç†å¿µ**ï¼šéƒ¨ç½²å³ç”¨ï¼Œä¸“æ³¨æ ¸å¿ƒä»·å€¼ï¼ŒæŠ€æœ¯æ¶æ„ç¨³å®šå¯é 
